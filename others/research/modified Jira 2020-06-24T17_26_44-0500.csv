Summary,Issue key,Issue id,Issue Type,Status,Project key,Project name,Project type,Project lead,Project description,Project url,Priority,Resolution,Assignee,Reporter,Creator,Created,Updated,Last Viewed,Resolved,Component/s,Due Date,Votes,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Labels,Description,Environment,Watchers,Watchers,Watchers,Watchers,Watchers,Watchers,Watchers,Watchers,Watchers,Watchers,Original Estimate,Remaining Estimate,Time Spent,Work Ratio,Σ Original Estimate,Σ Remaining Estimate,Σ Time Spent,Security Level,Outward issue link (A Problem/Incident),Outward issue link (Blocks),Outward issue link (Blocks),Outward issue link (Blocks),Outward issue link (Blocks),Outward issue link (Cloners),Outward issue link (Dependent),Outward issue link (Relates),Outward issue link (Relates),Outward issue link (Relates),Outward issue link (Relates),Outward issue link (Relates),Outward issue link (Relates),Outward issue link (Treatment),Attachment,Attachment,Attachment,Attachment,Attachment,Attachment,Attachment,Attachment,Attachment,Custom field (Acceptance Criteria),Custom field (Action),Custom field (Activity),Custom field (Actual Time Completed),Custom field (Actual Time Started),Custom field (Additional Port(s)),Custom field (Additional Protocol),Custom field (All User Picker),Custom field (Approved),Custom field (Architect Approval By),Custom field (Architect Approval Date),Custom field (Assignee for Resolution Setting),Custom field (Attachments),Custom field (Auto Transition Of Parent),Custom field (BLSO),Custom field (BLSO By),Custom field (BLSO Date),Custom field (Back Out Plan),Custom field (Branching Automation By),Custom field (Branching Automation Date),Custom field (Business Impact),Custom field (Business Justification),Custom field (Business Value),Custom field (CAB Type),Custom field (Case Count),Custom field (Change Completion Date),Custom field (Change Start Date),Custom field (Change reason),Custom field (Change risk),Custom field (Change type),Custom field (Changelist Ids),Custom field (Changelist Ids),Custom field (Changelist Ids),Custom field (Changelist Ids),Custom field (Changelist Ids),Custom field (Changelist Ids),Custom field (Classification),Custom field (Clean Rules Regression By),Custom field (Clean Rules Regression Date),Custom field (Client Business Value),Custom field (Codecheck By),Custom field (Codecheck Date),Custom field (Codechecker),Custom field (Connection to other feedback),Custom field (Contingency plan),Custom field (Customer Impact Tier),Custom field (Customer Issue Owner),Custom field (Customer Issue Priority Type),Custom field (Customer Issue Rank),Custom field (Customer Issue Solution),Custom field (Customer Issue Type),Customer Request Type,Custom field (DOD Comments:),Custom field (Defect Environment),Custom field (Dependency),Custom field (Deployed to),Custom field (Deployment Infrastructure By),Custom field (Deployment Infrastructure Date),Custom field (Destination Hostname/IP),Custom field (Developer),Custom field (DoD Info),Custom field (ECD),Custom field (Emergency Deployment By),Custom field (Emergency Deployment Date),Custom field (Epic Link),Custom field (Expiration Date),Custom field (Feature Link),Custom field (Feature Name),Custom field (Final Release Demo URLs),Custom field (Final Release Note URLs),Custom field (Fixed In),Custom field (Found In),Custom field (GA-Release Rollout toggles),Custom field (Goal Outcome(s)),Custom field (Hydra ID),Custom field (Hydra Task),Custom field (Impact),Custom field (Implementation Plan),Custom field (Implementation by),Custom field (Initiative),Custom field (Investigation Results),Custom field (Investigation reason),Custom field (IsAutomated),Custom field (IsClientFacing),Custom field (Issue ID),Custom field (Knowledge Article link),Custom field (Known Problem),Custom field (Link to where the Problem is occuring),Custom field (Migration ID),Custom field (Nightly Deployment By),Custom field (Nightly Deployment Date),Custom field (Nightly Deployment Exception By),Custom field (Nightly Deployment Exception Date),Custom field (Operational categorization),Custom field (Original story points),Custom field (Other Design System),Custom field (Other Gating Details),Custom field (PHI/PII),Custom field (PHI/PII Justification),Custom field (PRE ID),Custom field (Parent Link),Custom field (Patch Group Date),Custom field (Patch Group Name),Custom field (Patch Time),Custom field (Patch Type (Deprecated)),Custom field (Patient Safety),Custom field (Pending reason),Custom field (Port(s)),Custom field (Post Change Plan),Custom field (Problem Theme),Custom field (Product Area),Custom field (Product Category),Custom field (Product Marketing Info),Custom field (Product Operations Owner),Custom field (Product categorization),Custom field (Project Classification),Custom field (Project Status),Custom field (Protocol),Custom field (QADev By),Custom field (QADev Date),Custom field (QATest By),Custom field (QATest Date),Custom field (Rank),Custom field (Release Demo),Custom field (Release FixVersions),Custom field (Release Notes Owner),Custom field (Release Preview Video),Custom field (Release Training Package),Custom field (Release Walk-Through Broadcast),Custom field (Remediation SLA),Custom field (Reported Product),Custom field (Request participants),Custom field (Requirement Status),Custom field (Resolution Summary),Custom field (Rollout Friction),Custom field (Rollout Toggle Name),Custom field (Rollout Toggle Version Key),Custom field (Root Cause),Custom field (Root Cause Inconclusive),Custom field (Root cause),Custom field (Salesforce ID),Satisfaction score (out of 5),Custom field (Schema Approval By),Custom field (Schema Approval Date),Custom field (Scope and Goal Deliverables),Custom field (Script Location),Custom field (Security By),Custom field (Security Date),Custom field (Setting / Toggle Name),Custom field (Severity),Custom field (Source),Custom field (Source),Custom field (Source Hostname/IP),Custom field (SpiraID),Sprint,Sprint,Sprint,Custom field (Story Points),Custom field (Success Metric),Custom field (Supports Code),Custom field (TLSO By),Custom field (TLSO Date),Custom field (Target Build),Custom field (Target end),Custom field (Target start),Custom field (Team),Custom field (Team Location),Custom field (Technical Implementation By),Custom field (Technical Implementation Date),Custom field (Test Environment Link),Custom field (Test Plan),Custom field (Theme),Time to approve normal change,Time to approve normal change simplified,Time to close after resolution,Time to close after resolution simplified,Time to first response,Time to first response simplified,Time to resolution,Time to resolution simplified,Custom field (Timeline Type),Custom field (Treatment plan),Custom field (Urgency),Custom field (Verified In),Custom field (Versions to Fix In),Custom field (What Host?),Custom field (Workaround),Custom field (Your team's Portfolio Plan),Custom field (athena Business Value),Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment,Comment
Copy up of anet_features_score_score-1697 on Mon Jun 22 11:04:31 2020,SCORE-1886,1303090,Integration,Patch,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,redger,redger,6/22/20 10:04,6/23/20 14:13,6/24/20 17:26,,,,0,,,,,,,,,,,,,,,"Send this task to another developer for codecheck.

Codechecker: validate that the [verify-copy-up validator|https://sparta-public.aws.athenahealth.com/tools/validation-overview?ignorePassing=false&ignorePending=false&validators=verify-copy-up&key=SCORE-1886] successfully ran.",,svcjir_atadmin,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1697,SCORE-1864,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/22/20 0:00,,,,,,,,,,,,,,3983818,,,,,,,,,,dpark,6/22/20 0:00,,,,,,,,,,,,,,,,,,redger,,,,,,,,,,,,,,,,,,,,,,,,,1303090,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1886</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dpark,6/22/20 0:00,rmallen,6/22/20 0:00,2|i0lcpl:y,,GA,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,Permanent,,,,0,,,,,"06/22/2020 10:04 AM;svcjir_atadmin;Hi [~redger], 

 Please make sure all the required sign offs (except QATest) are in place and assign it to QAWatertown in Pre-Deploy Check status.

If you have any question, Please reach out to #release_operation slack channel or email ReleaseOperations@athenahealth.com.

 *Note:* If this issue doesn't have any changelists attached because of a failed copy_up, then no further action is needed and this can be rejected. 

 thanks!",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
SPIKE: [10448] Appointment Checkin via API Causing 500 Internal Server Error,SCORE-1881,1150801,Bug,Coding,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,Medium,,dpark,ryburns,ryburns,2/13/20 10:22,6/23/20 14:18,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"[Client Facing]
 *Context:* [10448]
 *Department:* 99
 *Patient:* 109507
 *Users:* rburns38
 *Environment:* Live athenaNet

*Bug Description:*
 Multiple MDP partners are reporting consistent 500 Internal Server Errors when using the checkin endpoint across their table spaces. This does not appear to be a calls per day or per second issue based on the Mashery Logs.

The issue has been difficult to replicate because if the API fails, the standard workflow is to check the patient in via athenaNet, which tends to occur within a few minutes of the failed API call.

Note that this is specific to MDP partners (not tablespace) and has been reported by Phreesia, Health Note, and Epion. The logs/info here are for Health Note but cases 10321139 and 9418023 correspond to the cases from Epion and Phreesia

*Replication Steps:*
 We have been unable to replicate the issue in an internal environment, even using the same appointments in PTEST that caused problems in PRD. I have attached the logs from partner Health Note for an example of a successful and unsuccessful check in.

Below are how to use the endpoint for reference:
 Log into context 10448 as rburns38 or anyone who can use the MDP API Test page
 Open MDP API Test (Gear > Root > MDP API Test under More Disruption Please)
 Partner Select: Health Note
 Endpoint Search: GET /appointments/booked with department: 99, enddate (today's date), startdate (today's date) to get an appointment for today with appointmentstatus: ""f"". Save off the ID
 Run the endpoint POST /appointments/\{appointmentid}/checkin with the appointmentid you saved off to check in the appointment

*API Endpoints:*
 POST /appointments/\{appointmentid}/checkin

*Known Workarounds:*
 Check in the patient via athenaNet

*Client Impact:*
 Our MDP partners are noticing an increase in these errors and we cannot give an explanation. Customers are frustrated that their tablet based check-in workflows don't work consistently.

 

*Information from Mashery (athena's API Vendor):* 

A support ticket was opened with Mashery given the same information above as it was suspected that these errors were originating from Mashery. The response received from Mashery was that they reviewed their logs on the given API users/keys provided and the error is ""500_Internal_Server_Error_API"" and this error is coming from the Target host (athena) and not Mashery.

The also checked athenahealth's traffic overall and the 500 errors are coming as ""500_Internal_Server_Error_API"", if these were coming from Mashery proxy, the expected error is ""500_Internal_Server_Error_Proxy"" and not ""500_Internal_Server_Error_API"".

I have attached a graph provided by Masher showing 24 hours of traffic 3/10 - 3/11 and I believe the a-axis of this graph is in GMT as Mashery typically operates in this timezone. I have requested the contact from Mashery confirm this.

Mashery also stated that they observed a few 504s from the same target host, and that their java logs are indicating some connection issues as well with the Target host (athena). Could you please check health of target/backend host during the failure time frames.

Mashery logs:
 [2020-03-11T19:21:45+00:00] WARN [proxy-server-1880] c.m.proxy.responder.DefaultAdapter 1583954505.397_8ggvbcdnbfzj73pmdwr2nfua_h4unhpz6r54zzmaxm4m87f86 - ProxyClientException: java.net.SocketException: Connection reset

 ",,achen,agrabowski,crrogers,jbickford,ldunn,midavis,mokhan,ncross,phofmann,ryburns,,,,,,,,,,,,,,,,SCORE-1634,DBADMIN-3056,SCORE-1632,DBADMIN-3042,INCIDENT-2247,NOC-24402,,06/12/2020 12:52 PM;ryburns;Epion 500 Errors June 2020.png;https://athenajira.athenahealth.com/secure/attachment/573048/Epion+500+Errors+June+2020.png,03/26/2020 3:13 PM;ryburns;Find Department from appointmentid.sql;https://athenajira.athenahealth.com/secure/attachment/519999/Find+Department+from+appointmentid.sql,06/12/2020 12:52 PM;ryburns;Health Note 500 Errors June 2020.png;https://athenajira.athenahealth.com/secure/attachment/573049/Health+Note+500+Errors+June+2020.png,02/13/2020 10:22 AM;ryburns;Log Subset Error Scenario.txt;https://athenajira.athenahealth.com/secure/attachment/495855/Log+Subset+Error+Scenario.txt,02/13/2020 10:23 AM;ryburns;Log Subset Success Scenario.txt;https://athenajira.athenahealth.com/secure/attachment/495856/Log+Subset+Success+Scenario.txt,03/16/2020 9:39 AM;crrogers;Mashery Graph of 500 Errors.png;https://athenajira.athenahealth.com/secure/attachment/513950/Mashery+Graph+of+500+Errors.png,06/12/2020 12:52 PM;ryburns;Phreesia 500 Errors June 2020.png;https://athenajira.athenahealth.com/secure/attachment/573050/Phreesia+500+Errors+June+2020.png,02/13/2020 10:24 AM;ryburns;healthnote-athena-statuscode-500.log;https://athenajira.athenahealth.com/secure/attachment/495857/healthnote-athena-statuscode-500.log,06/22/2020 9:40 AM;crrogers;image-2020-06-22-10-40-02-807.png;https://athenajira.athenahealth.com/secure/attachment/578236/image-2020-06-22-10-40-02-807.png,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,P4 Production,,,,,,,,,,,,,1150801,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1881</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpl:w,,GA,,,,,,,,,,,None,None,<Text here>,,,"10346733, 10321139 & 9418023",,,,,,,,,3,,,,,Danish Denmark,Ecuador Eclair,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,"02/13/2020 10:22 AM;ryburns;Task created via '[bug triage|https://devnet.athenahealth.com/bug_triage]'

Originally sent to 'Scheduling: Core Architecture'.

","03/16/2020 9:40 AM;crrogers;I have added more details to the case description under the section titled '*Information from Mashery (athena's API Vendor)*' from an open support case with Mashery. At this time the problem appears to have something to do with connectivity issues between athena and Mashery and they are stating that the error is being generated from the athena side per their logs. 

 ","03/26/2020 3:10 PM;ryburns;Hi All - I wanted to add this bit of investigation that I did. I wasn't able to get all the way to a root cause, but this is the exact error we're seeing on the server for the case of Health Note:
[03/24/2020 13:37:48 web4272.athenahealth.com /usr/local/athena/prod/htdocs/hidden_exposed.esp 19043] POST,/v1/10448/appointments/3036085/checkin,INVALIDRESPONSE,API-685,An internal error has occurred.,An internal error has occurred.,,""Error calling BusCall::Appointment::SaveCheckIn: ASSERTION FAILED: DEPARTMENTID is missing. at /usr/local/athena/prod/perllib/Athena/MSPQGroup.pm line 455

I have not confirmed it's the same for all 3 MDP partners, but Epion has reported the issue is exclusive to Medicare as a Secondary Payer (MSP) patients which this seems to support.

From what I can tell, this is happening because of /perllib/Athena/Appointment.pm line 14370 which is making this call:
my $confirmprimary = BusCall::PatientDemographics::GetMSPQSettingValue( $dbh, { KEY => 'PRIMARYQUALIFIERYN', DEPARTMENTID => $departmentid}) ? 'true' : 'false' ;
 
And $departmentid isn’t being set correctly. It should be coming from an argument of the subroutine CheckinCheckForm.
 
That subroutine is called using the $departmentid from the hash built by Athena::Appointment::API::PassThrough::AppointmentFillAppointment, but when I try to replicate the SQL in the FillAppointment subroutine of  perllib/Athena/Appointment.pm I am able to find a valid department (I've attached that to this JIRA for appointment 3036085 context 10448)

So I'm not sure what's happening that causes this $departmentid variable to not be set.
","04/14/2020 4:40 PM;jbickford;Hi all - can we get an update on this JIRA? This is of particular importance to two of our Marketplace partners, Health Note and Epion. Is there anything we can do to escalate this? ","04/15/2020 9:25 AM;midavis;Hello [~jbickford] - we have a spike set-up in our backlog to evaluate this bug, its pretty far down the backlog though and can't make a commitment when we'll get to it. Our team is tasked with several COVID related projects that are taking precedence over this.

 

I can make this the next legacy bug we address, likely early May?

FYI [~dacurtis]","05/27/2020 10:15 AM;crrogers;Hello [~midavis]

These 503 errors appear to be tied to a bigger issue that requires further investigation and completion of this and NOC-24402 t in order to move forward with remediation and prevention steps to conclude Incident-2247. Incident-2247 may have been the direct result of how MDP Partner Phreesia' workflow applied in response to receiving these 503 errors, which means that it could have potentially been avoided if investigation was completed sooner.  

Back on 4/15 you stated there would be a target of early May to begin investigation, now that it is almost June is it possible to prioritize this request especially given the circumstances surrounding Incident-2247? 

Thank you,

 

CC:[~phofmann]","05/27/2020 10:34 AM;midavis;This is marked as a severity 3 bug.  Is there new information that warrants changing that status?

FYI [~dacurtis] - did we discuss ""incident 2247"" at grooming?  Sounds familiar. ","06/01/2020 11:52 AM;midavis;what exactly is Incident-2247 [~crrogers] I'm reviewing this ticket with the team.

 

 ","06/01/2020 4:52 PM;phofmann;https://athenajira.athenahealth.com/browse/INCIDENT-2247



503 returned from DB41. If there is any specifics you and the team are looking for. We would be happy to collaborate with you and NOC.","06/11/2020 2:27 PM;midavis;[~phofmann] - Do you know if there is a ""check in "" or encounters team that may be better suited for this?  Its not clearly a scheduling issue.  

Thanks","06/11/2020 6:50 PM;phofmann;Hi [~midavis], per the go/ownership wiki [https://intranet.athenahealth.com/wiki/node.esp?CODERESOURCE=MDPP1%3A%3APOST%3A%2Fappointments%2F%7Bappointmentid%7D%2Fcheckin&CHECKBOX_FILE=file&CHECKBOX_ROUTE=route&ID=125369&Search=Search]] my team has been asked to use to identify code ownership for various API routes, your team is responsible for the POST /appointments/\{appointmentid}/checkin endpoint. We were told that the Product teams were responsible for maintaining this page so we would be able to identify the correct team to work with. Unfortunately, I am not able to to decide the product team that should be responsible for the investigation of the issue","06/12/2020 11:06 AM;midavis;[~phofmann] we identified the right home for this story and its being moved to the appropriate backlog and team now

 

PO is [~ncross]","06/12/2020 11:14 AM;ncross;Hi [~phofmann], [~ryburns], [~jbickford], and [~crrogers].  [~midavis] handed this bug to my team today which owns Check-in under the Communicator umbrella.  I'm moving this item to the PSCI backlog.

 

It should be noted that the Check-in team is only set up to support severity 1 and 2 teams as it is not actively staffed right now.  So, in order to address this issue, we'd need one of two things to happen:
1. It being re-classified as a Sev 1 or 2.

2. An escalation is made to our management and our zone director, [~csherbo].

 

Also, can someone provide how frequently we are getting 500s?  I see the attached Mashery view but the green line blows out the graph and I can't get a sense of the count for 500 errors.  Knowledge of the frequency of this issue could help drive a severity re-look.  

 

CC-ing [~lhargrove] for awareness.","06/12/2020 12:51 PM;ryburns;[~ncross] - getting the exact volume of 500s related to this endpoint is difficult because 500 is just a generic error. We don't really have insight into what endpoint caused it or if it was a valid error (API was called wrong) vs. something we need to look into more (why can I check in an appointment via the athena front end or if I wait two minutes and try again)? That being said, I have attached the volume of 500 errors for the 3 reporting partners for the month of June.

In my opinion, a severity increase would not be appropriate but an escalation would be. We have 3 partners, including our largest in Phreesia, that have been getting these errors since February. The only workarounds we have found are ""wait and try again"" or ""do the check-in in athena and not through API"". Our MDP points of contact are starting to get frustrated that we've been unable to provide any information as to why this happens, as it makes their application look unreliable when in fact it's our server throwing the error.

If there is any additional information that should be provided around client impact please let me know.","06/15/2020 9:06 AM;phofmann;[~ncross], would it be possible to have this investigated to confirm the issue is actually with code your team owns? I worry that we are going to find that the issue is actually owned by another team.","06/15/2020 9:26 AM;ncross;[~agrabowski] or [~bleipprandt], any quick thoughts here?  I'm not asking for a deep dive or huge time sync.  I can re-prioritize within WWF if you don't have thoughts or think it warrants a deep investigation.

 

CC [~lhargrove] for API awareness.",06/15/2020 10:02 AM;agrabowski;[~ncross] from a quick look at the code it doesn't seem like this endpoint is related to self check-in but has more to do with updating the appointment status and getting data ready for the encounter.  relevant function is _SaveCheckIn in p4/perllib/Athena/Appointment.pm,"06/15/2020 10:04 AM;ncross;Thanks [~agrabowski].

 

Based on that comment, [~phofmann], I think this would be Clinically owned.  Not sure what team though.  Perhaps in [~mokhan]'s team (or he could tell us where it might go)?","06/18/2020 2:00 PM;mokhan;if this is scheduling, Collector owns that, otherwise check with [~dwu]","06/18/2020 4:18 PM;ncross;According to the API ownership spreadsheet for appointments/\{appointmentid}/checkin, this is a SCORE owned API.  CCing [~dwu] and [~midavis]","06/19/2020 9:10 AM;midavis;[~ncross] - do you have that spreadsheet handy?  i'm sure I will get asked again why its scheduling that owns it, at least I can point to this spreadsheet.

 

 ",06/19/2020 9:54 AM;phofmann;We have been asked to use the go/ownership [https://intranet.athenahealth.com/wiki/node.esp?ID=125369] wiki. ,06/22/2020 9:40 AM;crrogers;Image from the page referenced in [~phofmann]'s comment above !image-2020-06-22-10-40-02-807.png!,"06/22/2020 11:07 AM;ldunn;[~sma]  Simon, had a conversation with [~phofmann] today about this ticket.  which has essentially been bounced around between multiple teams for months and continue to be a major issue for our top check-in vendors.

 

Patrick and I will be reminding folks that they can't push tickets around, but hoping in the interim, that you could take a  look at this ticket and help determine the source of the issue.  Adding [~spalanisamy] and [~kvidya] as FYI.  Thanks!!","06/22/2020 11:46 AM;midavis;we'll get on it now [~ldunn]

 

FYI - [~dacurtis]",,,,,,,,
Clean up legacy service references,SCORE-1870,1284494,Story,Coding,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,dterry,astrahan,astrahan,6/18/20 13:30,6/23/20 14:17,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"SDO-797 is removing the infrastructure/template code for the Azure resources tied to legacy services (PSX, scheduling-graphql, fhir-api). We will be tearing down the existing resources soon after.

There are still references to the legacy services within SCORE code/insomnia data, but I'm not familiar enough with the code to know if any are still relevant/used. Any dependencies or deprecated code should be remove.
There may be other references, but many can be found by searching for:
* psx
* graphql
* fhirapi
",,astrahan,bbartle,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1870</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1284494,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1870</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpl:r,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,3.5,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,Permanent,,,,0,,,,,06/18/2020 1:35 PM;bbartle;Don't forget the tooling solution - a lot of that was focused on pulling data from the legacy services,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
SPIKE: (Redo) Auto add/remove portal contexts to auto-sync,SCORE-1866,1284243,Story,New,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,midavis,midavis,6/18/20 10:49,6/24/20 9:59,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"Goal: No longer have to manually add/remove contexts.  

 

There are approx 2600 contexts on portal, I can provide a fixed list at the time of launch but it would be more robust to detect if a context has mappings and if so add to auto-sync.

Likewise if they remove mappings, turn off auto-sync.

AC:
 * Ability to detect if a context has mappings
 * Add to auto-sync if there are mappings
 * Turn Portal exposure channel on
 * Evaluate putting all 10K contexts on auto-sync as an option

 

with cosmos autopilot turned on (SCORE-1790), see if we can remove the auto-sync rate limiting that is in place.",,midavis,,,,,,,,,,,,,,,,,,,,,,,SCORE-1459,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1866</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-376,,,,,,,,,,,,,,,,,,,,1284243,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1866</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpk:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,Ecuador Eclair,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Manual resolves for merge down of anet_features_score_score-1697 on Thu Jun 18 10:21:00 2020,SCORE-1864,1284109,Integration,Patching,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/18/20 9:21,6/22/20 10:06,6/24/20 17:27,6/22/20 10:06,,,0,,,,,,,,,,,,,,,Send this task to another developer for codecheck to confirm that the conflict has been correctly resolved,,svcjir_build,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/18/20 0:00,,,,,,,,,,,,,,3979036,,,,,,,,,,bbartle,6/18/20 0:00,,,,,,,,,,,,,,,,,,redger,,,,,,,,,,,,,,,,,,,,,,,,,1284109,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1864</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,bbartle,6/18/20 0:00,,,2|i0md8a:,,GA,,,,,,,,,,,,,,,,,,,,,,mgerman,6/19/20 0:00,,,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,bbartle,6/18/20 0:00,,,,,,,,,,,,Permanent,,,,0,,,,,06/18/2020 11:31 AM;redger;[~mgerman] i need the Security signoff again for a merge resolve.  Thanks!,06/22/2020 10:06 AM;svcjir_build;Moving issue to Patching on behalf of redger's run of copy_up,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
SignalR integration throwing null reference exceptions,SCORE-1863,1283155,Story,Deploying,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/17/20 11:50,6/24/20 10:33,6/24/20 17:27,6/24/20 10:33,,,0,,,,,,,,,,,,,,,[Go to Log Analytics and run query|https://portal.azure.com/#@18e6b17d-ea1e-4559-ac89-6ed1f31ec201/blade/Microsoft_Azure_Monitoring_Logs/LogsBlade/resourceId/%2Fsubscriptions%2Fc068c3ec-4fc4-4822-993c-073af116477e%2FresourceGroups%2FSchedulingGlobalResources%2Fproviders%2FMicrosoft.Insights%2Fcomponents%2Fsched-master-ai/source/LogsBlade.AnalyticsShareLinkToQuery/q/H4sIAAAAAAAAA0utSE4tKMnMzyvmqlEoz0gtSlVIzskvTYkPys9J9UvMBXLz80oSM%252FOKFZTKU5MSCzKV4ApLKgtSFWxtFZSCK4tLUnP1%252FEpzcoJS04BSecmprjCDlbgA3dvrc2QAAAA%253D/timespan/2020-06-17T15%3A36%3A52.0000000Z%2F2020-06-17T16%3A36%3A52.0000000Z],,fmicle,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,06/23/2020 4:46 PM;fmicle;Untitled.png;https://athenajira.athenahealth.com/secure/attachment/579583/Untitled.png,06/23/2020 2:48 PM;redger;robert.patch;https://athenajira.athenahealth.com/secure/attachment/579490/robert.patch,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/24/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,fmicle,6/23/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1863</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1283155,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1863</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,fmicle,6/24/20 0:00,,,2|i0lcpl:xi,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* follow test plan from SCORE-1109 to set up your environment
 * run 
{code:java}
SS-SendScheduleUpdatedEvent -ScheduleID 14417-1-1{code}

 * verify that an event shows up on the event viewer
 * run
{code:java}
SS-SendScheduleUpdatedEvent -ScheduleID 14417-1-2{code}

 * verify that no event shows up on the event viewer",,,,,,,,,,Permanent,,,,0,,,,,06/18/2020 12:18 PM;redger;filed SCORE-1868 to address test coverage for this.  this story just fixes the error,"06/23/2020 4:46 PM;fmicle;Works as expected:

 !Untitled.png|thumbnail! ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Copy up of anet_features_score_1690 on Mon Jun 15 15:54:55 2020,SCORE-1848,1279119,Integration,Patch,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,redger,redger,6/15/20 14:54,6/23/20 14:09,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"Send this task to another developer for codecheck.

Codechecker: validate that the [verify-copy-up validator|https://sparta-public.aws.athenahealth.com/tools/validation-overview?ignorePassing=false&ignorePending=false&validators=verify-copy-up&key=SCORE-1848] successfully ran.",,svcjir_atadmin,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1748,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/15/20 0:00,,,,,,,,,,,,,,3973264,,,,,,,,,,fmicle,6/15/20 0:00,,,,,,,,,,,,,,,,,,redger,,,,,,,,,,,,,,,,,,,,,,,,,1279119,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1848</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,fmicle,6/15/20 0:00,fmicle,6/15/20 0:00,2|i0lcpg:,,GA,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,Permanent,,,,0,,,,,"06/15/2020 2:54 PM;svcjir_atadmin;Hi [~redger], 

 Please make sure all the required sign offs (except QATest) are in place and assign it to QAWatertown in Pre-Deploy Check status.

If you have any question, Please reach out to #release_operation slack channel or email ReleaseOperations@athenahealth.com.

 *Note:* If this issue doesn't have any changelists attached because of a failed copy_up, then no further action is needed and this can be rejected. 

 thanks!",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Readme-fixes-2-electric-boogaloo,SCORE-1847,1279093,Bug,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,jhilder,jhilder,6/15/20 14:38,6/19/20 9:45,6/24/20 17:27,6/16/20 9:40,,,0,,,,,,,,,,,,,,,Found a few small errors - might be worth correcting,,jhilder,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/16/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,redger,6/16/20 0:00,,,,,,,,,,,,,,,,,,jhilder,,,,,,,,,,,,P4 Feature,,,,,,,,,,,,,1279093,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1847</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/16/20 0:00,,,2|i0ljte:,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,1,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,Permanent,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Perl - ModifyAndBook: provider ID still not being returned,SCORE-1845,1278865,Bug,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,jolopez,jmello,jmello,6/15/20 11:36,6/17/20 18:27,6/24/20 17:27,6/17/20 18:27,,,0,,,,,,,,,,,,,,,"SCORE-1633 uses GetProviderIDsFromUsernames to get the provider ID, but GetProviderIDsFromNames should be used instead",,jmello,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,redger,6/16/20 0:00,,,DISABLED,,midavis,6/16/20 0:00,,,,,,,,,,,,,,3973428,3973429,,,,,,,,,redger,6/16/20 0:00,,,,,,,,,,,,,,,,,,dpark,,,,,SCORE-688,,,,,,,P4 Production,,,,,,,,,,,,,1278865,,,,,aflanagan,6/16/20 0:00,jolopez,6/16/20 0:00,,,,,,,,,6/18/20 0:00,Pre-Approved Patches,6/18/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1845</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/16/20 0:00,redger,6/17/20 0:00,2|i0liiy:,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,4,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"$AX_HOME/athenax perl-test Athena::Appointment::App::Scheduling::Appointment

verify unit tests pass",,,,,,,,,,Permanent,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Copy up of anet_features_score_score-1761 on Fri Jun 12 16:28:53 2020,SCORE-1839,1277855,Integration,Patch,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,dterry,dterry,6/12/20 15:28,6/23/20 14:09,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"Send this task to another developer for codecheck.

Codechecker: validate that the [verify-copy-up validator|https://sparta-public.aws.athenahealth.com/tools/validation-overview?ignorePassing=false&ignorePending=false&validators=verify-copy-up&key=SCORE-1839] successfully ran.",,dterry,svcjir_atadmin,,,,,,,,,,,,,,,,,,,,,,,,SPA-348,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,radpatel,6/12/20 0:00,,,,,,,,,,,,,,3971263,,,,,,,,,,cyarlagadda,6/12/20 0:00,,,,,,,,,,,,,,,,,,dterry,,,,,,,,,,,,,,,,,,,,,,,,,1277855,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1839</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,cyarlagadda,6/12/20 0:00,rmallen,6/22/20 0:00,2|i0lcpe:,,GA,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"New test named  GetAppointmentsForMDP_Test in
Athena/Athena/Appointment/App/Appointment_Test.pm
runs and passes.",,,,,,,,,,Permanent,,,,0,,,,,"06/12/2020 3:28 PM;svcjir_atadmin;Hi [~dterry], 

 Please make sure all the required sign offs (except QATest) are in place and assign it to QAWatertown in Pre-Deploy Check status.

If you have any question, Please reach out to #release_operation slack channel or email ReleaseOperations@athenahealth.com.

 *Note:* If this issue doesn't have any changelists attached because of a failed copy_up, then no further action is needed and this can be rejected. 

 thanks!",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
dev server certificate to whitelist,SCORE-1833,1277531,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/12/20 10:15,6/19/20 9:45,6/24/20 17:27,6/12/20 12:12,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/12/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,dterry,6/12/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1833</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1277531,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1833</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dterry,6/12/20 0:00,dterry,6/12/20 0:00,2|i0l37c:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* harr a dev server (or use mine: dev109:50350)
 * ss-useathenanetdevserver
 * launch web api
 * search schedules
 * verify you get 200",,,,,,,,,,Permanent,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Deadletter queue alert went off after prod deploy,SCORE-1831,1277455,Story,Rejected,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Won't Do,jpickens,redger,redger,6/12/20 9:25,6/19/20 9:37,6/24/20 17:27,6/19/20 9:37,,,0,,,,,,,,,,,,,,,"there's an app insights alert that monitors the deadletter queue.  after the weekly deployment, our test messages started going to the deadletter queue.  ",,jpickens,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1831</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1277455,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1831</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0l378:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,Permanent,,,,0,,,,,"06/18/2020 10:19 PM;jpickens;The night of the deployment when this issue occurred, the deployment began at 2am on 6/12 GMT.  It looks like there were a couple failed deployments before a successful one.  Then the first log of {{AthenaNetReadAudit_QueueInfo}} into {{customEvents}} was at 2:15am GMT, indicating that the {{AthenaNetReadAuditMonitor}} AZ function ran for the first time at that point.  And when it ran for the first time, it found 3 messages in the DLQ.

My theory is that this resulted from a weird race condition between the deployment of the {{AthenaNetReadAudit}} AZ function for the first time and the integration test that puts test messages into the {{prod--anet-read-audit}} queue.  I'm guessing that with the failed deployments and what may be a slight delay between deployment of AZ functions and when they are able to run, the Service Bus integration test managed to put test messages into the queue before the AZ function was in a state where it was ready to process the messages, causing them to be DLQ'd.  And since we had a couple failed deployments, we ended up with multiple messages in the DLQ.

Going forward, I think it probably shouldn't happen again because even if there is a delay between deployment of the AZ function and when they are able to run, now that the AZ functions have been deployed, they should be able to process the messages.  The only potential problem is that if a deployment includes changes to the AZ function that processes the queue, the test message from the integration test run during deployment may get processed by the previous version of the function, but I don't see this as a significant problem.

The deployment at 2am on 6/19 GMT went smoothly and no messages seemed to go into the DLQ, which would seem to confirm my theory.  I think it's safe to close this out as a one-off that is unlikely to happen again.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Copy up of anet_features_score_score-1793 on Thu Jun 11 10:28:55 2020,SCORE-1821,1276230,Integration,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/11/20 9:28,6/18/20 18:37,6/24/20 17:27,6/12/20 12:59,,,0,,,,,,,,,,,,,,,"Send this task to another developer for codecheck.

Codechecker: validate that the [verify-copy-up validator|https://sparta-public.aws.athenahealth.com/tools/validation-overview?ignorePassing=false&ignorePending=false&validators=verify-copy-up&key=SCORE-1821] successfully ran.",,svcjir_atadmin,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1793,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/11/20 0:00,,,,,,,,,,,,,,3969472,,,,,,,,,,dpark,6/11/20 0:00,,,,,,,,,,,,,,,,,,redger,,,,,,,,,,,,,,,,,,,,,,,,,1276230,,,,,,,,,,,,,,,,,6/19/20 0:00,06/19/20 Biweekly Train,6/19/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1821</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dpark,6/11/20 0:00,rmallen,6/11/20 0:00,2|i0l376:,,GA,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,Permanent,,,,0,,,,,"06/11/2020 9:28 AM;svcjir_atadmin;Hi [~redger], 

 Please make sure all the required sign offs (except QATest) are in place and assign it to QAWatertown in Pre-Deploy Check status.

If you have any question, Please reach out to #release_operation slack channel or email ReleaseOperations@athenahealth.com.

 *Note:* If this issue doesn't have any changelists attached because of a failed copy_up, then no further action is needed and this can be rejected. 

 thanks!",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Update prodmirror certificate,SCORE-1819,1275036,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,redger,redger,redger,6/10/20 14:40,6/12/20 9:27,6/24/20 17:27,6/10/20 16:19,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,dacurtis,6/10/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,dstrickland,6/10/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1819</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1768,,,,,,,,,,,,,,,,,,,,1275036,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1819</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dstrickland,6/10/20 0:00,,,2|i0kv3o:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,,,1,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,ensure PR builds,,,,,,,,,,Permanent,,,,0,,,,,"06/10/2020 2:49 PM;redger;also files SCORE-1820 to do this dynamically going forward

 ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
SPIKE: Investigate double-booked slot,SCORE-1818,1274710,Bug,Rejected,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Won't Do,jpickens,jpickens,jpickens,6/10/20 11:03,6/22/20 15:51,6/24/20 17:27,6/22/20 15:51,,,0,,,,,,,,,,,,,,,"From the Production Support channel...

{quote}[Yesterday 12:26 PM] Kera Knight
    
Good Afternoon - can someone take a look at client 14035, patient 203322 had an appointment already scheduled for 4pm scheduled in May, however on 6/8, patient 757969 scheduled the same slot in Consumer
<https://teams.microsoft.com/l/message/19:bbef1fca7f4440cf90c62ad4530ee876@thread.skype/1591723562070?tenantId=3d44f5c7-726e-45cd-b26c-3e58cddea376&amp;groupId=d66b1ad7-ae29-4f77-8ab2-3b88a773459e&amp;parentMessageId=1591723562070&amp;teamName=PatientExp.Scheduling&amp;channelName=Production Support&amp;createdTime=1591723562070>{quote}

In looking closer at the problem, [~gdawson] found that patient 203322 had a 15 minute appointment booked at 4pm on 6/15 with the provider.  Patient 757969 was created via Consumer Scheduling and booked a 30 minute appointment with the same provider at 3:45pm, which overlapped the existing appointment.

Kera reports that she does not see a double booking in the calendar; however, the first patient still appears to have the initial appointment booked.",,jpickens,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1768,,,,,,,BB Production,,,,,,,,,,,,,1274710,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1818</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0kv3m:,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,2,,,,,Danish Denmark,,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,Permanent,,,,0,,,,,06/16/2020 11:23 AM;jpickens;I attempted to recreate the issue in QA via [NonProd Consumer|https://consumer.scheduling.nonprod.athena.io/?locationId=14035-155&practitionerId=14035-532] last week before the newer patient and appointment had propagated from production.  But I saw no availability until July.,"06/16/2020 11:25 AM;jpickens;I consulted with [~jmello] and she thought it looked like the second appointment had been forced, but since it was booked via Consumer, that should not have been possible.  She recommended investigating whether a template change might have been involved.  I followed-up with [~keknight], but she confirmed that no template changes have been made recently.","06/22/2020 3:51 PM;jpickens;I think it's safe to close this out for now.  If Kera gets more information or if we see it again, we can always re-visit.  But for now, I was unable to recreate the issue and we never saw any indication that the second appointment was ever actually booked.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Copy up of anet_features_score_score-1744sched on Mon Jun  8 22:42:51 2020,SCORE-1812,1272428,Integration,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,cyarlagadda,cyarlagadda,6/8/20 21:42,6/18/20 18:37,6/24/20 17:27,6/12/20 12:59,,,0,,,,,,,,,,,,,,,"Send this task to another developer for codecheck.

Codechecker: validate that the [verify-copy-up validator|https://sparta-public.aws.athenahealth.com/tools/validation-overview?ignorePassing=false&ignorePending=false&validators=verify-copy-up&key=SCORE-1812] successfully ran.",,cyarlagadda,svcjir_atadmin,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1744,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/9/20 0:00,,,,,,,,,,,,,,3965699,,,,,,,,,,redger,6/9/20 0:00,,,,,,,,,,,,,,,,,,cyarlagadda,,,,,,,,,,,,,,,,,,,,,,,,,1272428,,,,,,,,,,,,,,,,,6/19/20 0:00,06/19/20 Biweekly Train,6/19/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1812</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/9/20 0:00,redger,6/9/20 0:00,2|i0ki56:,,GA,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,redger,6/9/20 0:00,,,,,,,,,,,,,,,,0,,,,,"06/08/2020 9:42 PM;svcjir_atadmin;Hi [~cyarlagadda], 

 Please make sure all the required sign offs (except QATest) are in place and assign it to QAWatertown in Pre-Deploy Check status.

If you have any question, Please reach out to #release_operation slack channel or email ReleaseOperations@athenahealth.com.

 *Note:* If this issue doesn't have any changelists attached because of a failed copy_up, then no further action is needed and this can be rejected. 

 thanks!",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Patient Search Audit-able Event Tracking,SCORE-1805,1272177,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,midavis,midavis,6/8/20 15:07,6/19/20 9:45,6/24/20 17:27,6/16/20 12:34,,,0,,,,,,,,,,,,,,,"Add audible event ""Patient Search"" this is an existing entity and type.

 

Entity: patient search

Type: view

 

This should occur for every patient returned in a search that the user could have seen.  

 

Additional Examples:

[https://athenaconfluence.athenahealth.com/pages/viewpage.action?spaceKey=SCHEDULE&title=Audit+Logging]",,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/15/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,fmicle,6/12/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1805</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1587,,,,,,,,,,,,,,,,,,,,1272177,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1805</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,fmicle,6/12/20 0:00,,,2|i0ki5a:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* harr a dev server from the code on the SCORE-1748 task (code is actually branched under SCORE-1690)
 * SS-SetupSCORE
 * ss-useathenanetdevserver
 * 
{code:java}
SS-SaturateServiceBus `
 -NumberOfMessages 1 `
 -MessageType AthenaNetPatientSearchMessage `
 -PatientID 1 `
 -UserName ""your user name""{code}

 * wait until the queue is processed
 * using sql++, query the pageview table for 432 on MAINFTR1 (or whatever the master root instance of your dev server is)
{code:java}
SELECT * 
FROM PAGEVIEW 
WHERE CREATED > trunc(sysdate) AND CREATEDBY = 'your user name' AND NOTE IS NULL;{code}

 * verify you see the entry for the record you just sent
 * now send a message with a note and no patient id:
{code:java}
SS-SaturateServiceBus `
 -NumberOfMessages 1 `
 -MessageType AthenaNetPatientSearchMessage `
 -Note 'im a test!' `
 -UserName ""your user name""{code}

 * query again:
{code:java}
SELECT * 
FROM PAGEVIEW 
WHERE CREATED > trunc(sysdate) AND CREATEDBY = 'your user name' AND NOTE IS NOT NULL;{code}

 * verify you see the new record, and that it has your note",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
fix integration test for audit queue,SCORE-1795,1271842,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/8/20 11:36,6/12/20 9:27,6/24/20 17:27,6/8/20 12:21,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/8/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,fmicle,6/8/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1795</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1271842,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1795</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,fmicle,6/8/20 0:00,,,2|i0ke5o:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,* verify pr runs successfully,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Create buscall to check user access to schedule,SCORE-1794,1271767,Story,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/8/20 10:30,6/12/20 18:03,6/24/20 17:27,6/12/20 18:03,,,0,,,,,,,,,,,,,,,,,dpark,,,,,,,,,,,,,,,,,,,SPA-344,SPA-343,SPA-342,SPA-341,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,redger,6/10/20 0:00,,,DISABLED,,midavis,6/10/20 0:00,,,,,,,,,,,,,,3967360,3967361,3968096,,,,,,,,redger,6/10/20 0:00,,,,,,,,,,,,,,,,,,dpark,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1794</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1271767,,,,,aflanagan,6/10/20 0:00,jolopez,6/10/20 0:00,,,,,,,,,6/13/20 0:00,Pre-Approved Patches,6/13/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1794</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/10/20 0:00,redger,6/10/20 0:00,2|i0jtiu:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"Find an appointment that has status 'f' and scheduledby is not null
I used Context 13711


{code:java}
SELECT ID FROM APPOINTMENT WHERE STATUS = 'f' AND SCHEDULEDBY IS NOT NULL AND APPOINTMENTDATE > SYSDATE;
{code}

Hit the endpoint using the below script, replace parameters as needed
the USERNAME should come from the SCHEDULEDBY field from the appointment above
{code:java}
$ATHENA_HOME/scripts/mdp/apitest.pl --mdppartnerid=673 -i -X POST ""/v1/13711/subsystembuscall"" -H 'Accept: application/json' --params ""{\""subsystem\"": \""Appointment\"", \""sub\"": \""CheckUserAppointmentPermissionForSchedulingZone\"", \""params\"": { \""USERNAME\"": \""thendon\"", \""APPOINTMENTID\"": 4657049 } }"" --devserver ""dev103.athenahealth.com"" --devport 7482
{code}

This should return 1;

go back into SQL++ and update the appointment

{code:java}
UPDATE appointment SET departmentid = 999 where id = ?
{code}

rerun the above script the response should be 0

",,,,,,,,,,,,,,0,,,,,06/10/2020 9:23 AM;redger;no test coverage?,06/10/2020 10:28 AM;dpark;added unit tests.,"06/11/2020 12:08 PM;rmallen;[~redger], [~dpark], [~midavis]:  Non-consec with SUA-1463.  This task cannot be deployed until this has been resolved.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Create buscall to check user access to patient,SCORE-1793,1271765,Story,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,qawatertown,redger,redger,6/8/20 10:30,6/18/20 18:37,6/24/20 17:27,6/11/20 9:34,,,0,,,,,,,,,,,,,,,,,svcjir_build,,,,,,,,,,,,,,,,,,,SPA-366,SPA-343,SPA-341,SPA-340,,,,,,,,,,06/09/2020 11:19 AM;svcjir_verifycode;verify_code_2020-06-09-12:19.html;https://athenajira.athenahealth.com/secure/attachment/570158/verify_code_2020-06-09-12%3A19.html,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/10/20 0:00,,,,,,,,,,,,,,3966652,3966655,,,,,,,,,dpark,6/10/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1793</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1271765,,,,,,,,,,,,,,,,,6/19/20 0:00,06/19/20 Biweekly Train,6/19/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1793</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dpark,6/10/20 0:00,,,2|i0jtis:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,bbartle,6/10/20 0:00,,"* harr a dev server
 * log in to a context with Provider Groups turned on, e.g. 14417
 ** note that if you want to test with 14417 you need to set your MASTER_ROOT_INSTANCE to a stack that has 14417, e.g. DTEST1
 * go to Gear->Root->MDP API Test
 * select ""Smart Scheduling"" from the first dropdown
 * search for ""buscall"" in the second dropdown
 * execute with the following parameters:
 ** 
||Parameter||Value||
|subsystem|PatientDemographics|
|sub|DoesUserHaveAccessToPatient|
|parameters|{code:java}
{
    ""USERNAME"": ""your username"",
    ""PATIENTID"": <some existing patient id>
}{code}
_if you are testing in 14417,. you can use patient id 650_|

 * verify success, and that the response is ""1""
 * change the patient id to something that doesn't exist, e.g. 999999
 ** verify success, and that the response is ""0""
 * change patient id to something other than an integer
 ** verify ""ASSERTION FAILED""
 * change the patient id back, and change username to something that doesn't exist, e.g. ""x""
 ** verify ""0""
 * find a user with limited access in sql++
{code:java}
-- find a user that doesnt have root access
SELECT uc1.username FROM USERCONTEXT uc1 WHERE NOT EXISTS (SELECT NULL FROM USERCONTEXT uc2 WHERE uc2.username=uc1.username AND uc2.CONTEXTID=1) AND CONTEXTID=? AND ROWNUM < 10;

-- find a patient that IS in provider groups the user has access to
SELECT * FROM CLIENT WHERE providergroupid IN (SELECT d.providergroupid FROM USERDEPARTMENT ud inner join DEPARTMENT d on d.id=ud.departmentid where username= ? ) and nvl(status, 'a' )= 'a' AND ROWNUM < 10;

-- find a patient that is NOT in the provider groups the user has access to
SELECT * FROM CLIENT WHERE providergroupid NOT IN (SELECT d.providergroupid FROM USERDEPARTMENT ud inner join DEPARTMENT d on d.id=ud.departmentid where username= ? ) and nvl(status, 'a' )= 'a' AND ROWNUM < 10;

{code}

 * now execute the buscall with the username and patient id you found that should have access (first and second sql statements)
 ** verify ""1""
 * now execute the buscall with the username and patient id you found that should not have access (first and third sql statements)
 ** verify ""0""
 * log out and log in to a context that does NOT have provider groups turned on, e.g. 432
 * test the MDP API buscall again
 * as long as you enter a valid patient id, it shouldn't matter what you put for USERNAME",,,,,,,,,,,,,,0,,,,,"06/10/2020 4:12 PM;redger;TI signoff please, [~bbartle]

 ",06/11/2020 9:34 AM;svcjir_build;Moving issue to Patching on behalf of redger's run of copy_up,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Add this context(s) to auto-sync,SCORE-1791,1271671,Task,Done,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,midavis,midavis,6/8/20 9:33,6/10/20 9:29,6/24/20 17:27,6/9/20 16:46,,,0,,,,,,,,,,,,,,," 14130

 

Portal and consumer list",,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,Add,,,,,,,N/A,,,,,DISABLED,,midavis,6/10/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1271671,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1791</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0ki5a:c,,GA,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,06/09/2020 4:47 PM;redger;added to auto sync 6/9/2020,06/10/2020 9:29 AM;midavis;Channels enabled,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Turn on Cosmos AutoPilot,SCORE-1790,1270310,Story,Code Review,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,jpickens,redger,redger,6/5/20 9:48,6/24/20 14:28,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1885,SCORE-1882,SCORE-1892,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,jpickens,6/24/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1790</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-376,,,,,,,,,,,,,,,,,,,,1270310,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1790</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpj:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,2.5,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"h1. *SCORE*
 * SS-SetupSCORE; SS-BootstrapSCORELocalSettings; SS-SetupSCORELocalTestEnvironment;

 * 
 ** verify that cosmos has 2 new databases for your envKey, ContentAdmin and Caching
 ** there should be data in the normal collections which are populated by InsertTestData (mapping configuration, canonical service types, web sched config)

h2. Verify Web API functions correctly
 * using Insomnia, execute the ""Consumer -> Appointment Book With Demographics (chained)"" request, which will search for schedules, pick a slot, and book it
 ** verify success

h2. Verify ASE Functions function correctly
 * change your context id in your insomnia local settings file to be a context that you do not already have in your mapping configuration collection (e.g. 432)
 * using Insomnia, execute the ""ASE Functions -> Migrate AthenaNet Context Mapping"" request
 ** verify success
 ** verify that a mapping configuration for the context you chose appears in your collection

h2. Verify Integration/Functional tests work correctly
 * 
{code:java}
SS-SetupSCORELocalTestEnvironment -SetupPerformanceTests

SS-CreateCosmosTestDatabases{code}

 * 
 ** verify _test databases are created in cosmos

 * run the integration tests, functional tests, and performance tests locally from your machine
 ** verify success
 * 
{code:java}
SS-RemoveCosmosTestDatabases{code}

 * 
 ** verify the _test databases are removed

h2. Verify that copy cosmos can copy the same environment to the new database format
 * ask someone with access to LaunchDarkly to set up targeting such that your environment key serves ""false"" for the ""Score Use Predeployed Containers"" toggle
 ** note that the rules in LD are evaluated IN ORDER.  so when you add a new rule that says ""if environment == *rbe*, serve *false*"", it needs to appear _before_ the rule that says ""if environment != *master* serve *true*""
 * 
{code:java}
# insert test data into the original format
SS-InsertSCORETestData -TargetUsesPreDeployedContainers $False

# copy cosmos
SS-CopyCosmos -SourceEnvironmentKey <your env Key> -TargetEnvironmentKey <your same env key> -TargetUsesPreDeployedContainers{code}

 * 
 ** verify success
 ** the log statements should show something like this: 
{code:java}
Source Collection: rbe_anet-web-sched-config; Target Collection: anet-web-sched-config{code}

 * 
 ** where the source collection has your env Key as a prefix, and the target collection does not
 * ask someone with LD access to revert the change made above

 
h2. Cleanup
 * SS-Clean
 * verify the new databases are removed along with the normal set of things

h1. *RM*
 * 
{code:java}
RM-Setup
RM-CreateCosmosTestDatabases{code}

 * Follow directions from SCORE-1571 for testing UHG endpoints
 * RM-Clean
 ** verify new databases are removed along with the normal set of things

 ",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"health check is returning ""unhealthy"" for athenanet",SCORE-1788,1269663,Bug,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,High,Done,,bbartle,bbartle,6/4/20 23:15,6/12/20 9:27,6/24/20 17:27,6/8/20 16:56,,,0,,,,,,,,,,,,,,,"It appears SCORE-1589 introduced a change which caused our healthcheck endpoint to return ""unhealthy"" when pinging MDP.

[https://score-webapi-master.scheduling.nonprod.athena.io/health] is returning
{code:java}
{
  ""GlobalStatus"": ""Unhealthy"",
  ""Results"": {
    ""Persistence"": {
      ""Status"": ""Healthy""
    },
    ""athenaNet"": {
      ""Status"": ""Unhealthy""
    },
    ""Eventing"": {
      ""Status"": ""Healthy""
    }
  }
}
{code}
even though MDP is up and we can hit the ""ping"" endpoint directly.",,bbartle,jpickens,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1787,,,,,,INCIDENT-2357,06/08/2020 2:26 PM;jpickens;screenshot-2.png;https://athenajira.athenahealth.com/secure/attachment/569520/screenshot-2.png,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/8/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,jpickens,6/8/20 0:00,,,,,,,,,,,,,,,,,,redger,,,,,,,,,,,,BB Production,,,,,,,,,,,,,1269663,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1788</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jpickens,6/8/20 0:00,jpickens,6/8/20 0:00,2|hv0lg0:44,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,3,,,,,Cape Cod Creme Brulee,Danish Denmark,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* run the web api
 * hit the /health endpoint
 * verify success
 ** if anything says ""degraded"", refresh a couple of times, it should eventually say healthy",,,,,,,,,,,,,,0,,,,,"06/05/2020 4:29 PM;jpickens;Error:
{code}
""Expected exactly 1 'SchedulingTargetVendor' claim, but found 0\nCould not parse SchedulingTargetVendor claim""
{code}

Stacktrace:
{code}
   at athenahealth.Scheduling.Services.Adapters.Authorization.ClaimsIdentityPrincipalProvider.GetTargetVendor(IEnumerable`1 claims) in C:\\git\\sched\\services\\src\\Adapters\\Authorization\\ClaimsIdentityPrincipalProvider.cs:line 457\r\n   at athenahealth.Scheduling.Services.Adapters.Authorization.ClaimsIdentityPrincipalProvider.GetSchedulingPrincipal(IEnumerable`1 claims) in C:\\git\\sched\\services\\src\\Adapters\\Authorization\\ClaimsIdentityPrincipalProvider.cs:line 379\r\n   at athenahealth.Scheduling.Services.Adapters.FeatureFlags.LaunchDarklyUserBuilder.Build(IUserBuilder builder) in C:\\git\\sched\\services\\src\\Adapters\\FeatureFlags\\LaunchDarklyUserBuilder.cs:line 33\r\n   at athenahealth.Scheduling.Global.Adapters.FeatureFlags.LaunchDarklyClient.GetUser()\r\n   at athenahealth.Scheduling.Global.Adapters.FeatureFlags.LaunchDarklyClient.BoolVariation(FeatureFlag`1 featureFlag)\r\n   at athenahealth.Scheduling.AthenaNet.Adapters.FeatureFlags.CheckAthenaNetFeatureFlags.PassSessionUser()\r\n   at athenahealth.Scheduling.AthenaNet.Adapters.MDP.MDPClient.<CallMDPEndpointAsync>d__60`1.MoveNext()\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()\r\n   at athenahealth.Scheduling.AthenaNet.Adapters.MDP.MDPClient.<CallMDPEndpointWithRetryAsync>d__59`1.MoveNext()\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()\r\n   at athenahealth.Scheduling.AthenaNet.Adapters.MDP.MDPClient.<PingAsServiceAsync>d__11.MoveNext()\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()\r\n   at athenahealth.Scheduling.Services.WebAPI.HealthChecks.MDPHealthCheck.<CheckHealthAsync>d__4.MoveNext() in C:\\git\\sched\\services\\src\\WebAPI\\HealthChecks\\MDPHealthCheck.cs:line 49
{code}","06/05/2020 4:39 PM;jpickens;This seems to stem from calling {{checkFeatureFlags.PassSessionUser()}} in {{MDPClient}}.  The problem appears to result from the fact that the health check endpoint is hit directly, rather than through the web app, so there is no athena user or session associated.  Thus, the code is attempting to get the target vendor, which also doesn't exist.","06/08/2020 2:26 PM;jpickens;QA:
 !screenshot-2.png|thumbnail! ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Disable get patient by id endpoint for practice,SCORE-1774,1267695,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/3/20 9:40,6/12/20 9:27,6/24/20 17:27,6/4/20 8:49,,,0,,,,,,,,,,,,,,,"we aren't doing any sort of access check for the get patient by id endpoint for the practice workflow.  disable the endpoint by commenting out the method in the controller, and follow up in another story to figure out the correct way to do auth",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/3/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,dpark,6/3/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1774</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1267695,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1774</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dpark,6/3/20 0:00,,,2|i0j841:w,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,0,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
create rollout toggle for SCORE-1470,SCORE-1773,1267685,Story,Done,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,midavis,dpark,dpark,6/3/20 9:37,6/20/20 15:48,6/24/20 17:27,6/18/20 8:43,,,0,ACWellness,,,,,,,,,,,,,,"Needs Key 'SCORE_1470_USE_DEFAULTS_FOR_SCHEDULINGMINHOURS'
With Values: 'ON' and 'OFF'",,dpark,kneuberger,mheang,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1773</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1267685,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1773</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0g58o:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,"06/10/2020 10:52 AM;dpark;[~kneuberger] when this gets toggled for AC wellness they should see the fix in SCORE-1470, i am not sure how rollout toggles work in preview. Please work with [~midavis] to get this rolled out to them.","06/10/2020 4:14 PM;midavis;i'm not familiar with rollout toggles in preview either, do we need it in preview?

i don't think i've done this yet in production.  Is that something i should do now? [~dpark] ","06/11/2020 7:49 AM;kneuberger;hey [~mdavis] and [~dpark] we need this toggle built in both preview and production. The process for the building/creation of the toggle though should be the same I believe regardless of environment. Once its created, I can go ahead and schedule rollout toggle waves for 19661 in both if that is helpful! 

Can you verify that your team though will work to get this toggle GA once in place? Meng made a good point that this change should be rolled out universally and the toggle move to GA in a timely manner? 

CC: [~mheang] ","06/11/2020 1:24 PM;midavis;Is the plan to do this as a rollout toggle for 1...and then go GA?

 

 Also - I thought preview was not a wise place to do rollout toggle work as its routinely over-written from production.  ","06/11/2020 2:37 PM;kneuberger;[~midavis] I will look to you all on the GA rollout plan for this. I do think this should be something applied across the board, however, if we are deploying it behind a toggle. 

In regards to preview, I use preview pretty often with ACW and other clients to test out new features that we have behind toggles. I think if the toggle is created in production it will sync to preview overnight (but i have seen folks just create it in both places right off the bat). Once the toggle is in preview, the rollout wave has to set in preview itself so that piece itself does not sync from prod. This page might be source of truth on this: [https://athenaconfluence.athenahealth.com/pages/viewpage.action?spaceKey=SES&title=Rollout+toggles+and+Practice+settings+in+Support+Environments]

ACW will need this deployed in both environments to utilize and test this was successful. 


 ","06/11/2020 3:49 PM;midavis;[~dpark] is there any reason this shouldn't go GA to every context?  There is a bi-weekly on 6/19 we could probably get it into that if its low risk.

 

 ","06/16/2020 8:17 AM;kneuberger;Hi [~midavis] and [~dpark] Do we have an update on this? Are we moving forward with the toggle? If so, what is the ETA for when this will be built in Prod/preview? 

CC: [~mheang]","06/16/2020 10:22 AM;midavis;I believe David will be responding shortly, as to preview and prod...if preview catches up with prod periodically, i would just assume do it in prod and let the system take care of itself.

 

 ","06/16/2020 11:07 AM;dpark;Hi [~midavis] I wanted to make sure it works with acwellness before moving on to other contexts because they seem to be the ones actively using this. I am not familiar with toggles in production either, I can do some research but I am fairly certain that doing this in production would have a downstream effect of it going to preview as well.",06/16/2020 11:10 AM;dpark;It looks like the creation of the toggle is downstreamed to support environments we will still have to manually turn it on for ACWellness in preview until it is GA in production,06/16/2020 11:12 AM;dpark;The reason I want it to rollout for just 1 context is because it involves some database queries and I would not like to accidentally break that somehow.,"06/16/2020 11:33 AM;midavis;Toggle in production created for 19661, and sent to [~keknight] for approval.

 

Kera - this is a bug fix for AC Wellness, we are releasing this bug fix for them only to confirm it works, then will GA it.

 

Mike

 ",06/16/2020 2:24 PM;midavis;[~kneuberger] - this will be live on production tomorrow for AC Wellness,"06/16/2020 2:33 PM;kneuberger;[~midavis] thank you! 

I will look for the toggle for preview tomorrow also and then set that on! 

 

CC: [~mheang]",06/17/2020 11:32 AM;midavis;Do we know if the customer looked at this in prod or if Preview caught up yet? [~kneuberger],"06/18/2020 8:03 AM;kneuberger;[~midavis] This turned on in preview today for ACW. [~mheang] is handling communication to the client and was going to notify them of both the Preview and Production space being turned on to verify no issues arise in either environment. 

[~mheang] Mind providing an update on if the client has been notified as of yet?","06/20/2020 3:47 PM;mheang;Hey team - ACW has been notified of this change in Preview and Production.  I asked them to verify that the issue is resolved, within the next week (by 6/26).",,,,,,,,,,,,,,,,
RM DI is broken,SCORE-1766,1266408,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/2/20 12:13,6/12/20 9:31,6/24/20 17:27,6/2/20 13:42,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/2/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,gdawson,6/2/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1766</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1266408,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1766</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,gdawson,6/2/20 0:00,,,2|i0j841:r,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,0,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* rm-setup
 * generate an athenanet jwt token on an anet dev server
{code:java}
export ATHENA_HOME=/usr/local/athena/prod/; perl -MAthena::Lib -MAthena::Driver::IdentityAccessManagement -e '$Global::session{USERNAME} = ""redger""; print ""\ntoken:\n"" . Athena::Driver::IdentityAccessManagement::GetAthenaNetSignedUserJWT(undef, {SCOPES => [""scheduling.token.create""]}) . ""\n"";'{code}

 * hit InitiateEligibilityCheck in RM
 ** token = (from above)
 ** contextid = 432
 ** patientid = 1035931
 ** chartid = 2085367
 ** departmentid = 1
 * verify you get 202 accepted",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Swagger example for /adminbooking/modifiedbooking is invalid,SCORE-1758,1265236,Bug,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,jmello,jmello,6/1/20 16:27,6/19/20 9:45,6/24/20 17:27,6/16/20 14:34,,,0,,,,,,,,,,,,,,,"# ServiceType is on Slot, it needs to be on Appointment
 # Status needs to be on the same Appointment.ParticipantComponent as Actor
 #  Patient context id is 14417, all other contextd ids are 432",,jmello,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/16/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,redger,6/16/20 0:00,,,,,,,,,,,,,,,,,,jhilder,,,,,SCORE-257,,,,,,,BB Production,,,,,,,,,,,,,1265236,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1758</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/16/20 0:00,,,2|i0jcw2:,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,4,,,,,Danish Denmark,,,1,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"First off, the tester should  execute the swagger endpoint with the default input.
Make sure you do not get a 400 error. Double check that your insomnia file outside of your repository has a contextID of 432, and not 14417.
If you are getting a 401 error make sure that everything is authenticated properly. ",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
performance tests missing IMDPSessinUserAccessor,SCORE-1751,1264790,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,6/1/20 11:55,6/12/20 9:27,6/24/20 17:27,6/1/20 12:56,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/1/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,jmello,6/1/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1751</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1264790,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1751</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jmello,6/1/20 0:00,,,2|i0j840:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,0,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* check out branch
 * run performance tests",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Only pass patient condition fields in C# if a feature flag is on,SCORE-1750,1264730,Bug,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,jmello,jmello,6/1/20 11:00,6/12/20 9:27,6/24/20 17:27,6/2/20 14:11,,,0,,,,,,,,,,,,,,,"In perl, we assert that _only_ the expected fields are being passed an throw an exception if any extra fields are being passed.  The changes to accept the patient condition fields haven't made it to prod yet.  In c#, we just merged changes to always pass patient condition fields (defaulting to false).  However, the changes to accept patient condition fields haven't made it into perl production/prodmirror yet, so they're being considered ""extra"" and an exception is being thrown.  We should add a feature flag and only pass patient condition fields if the flag is on. ",,jmello,,,,,,,,,,,,,,,,,,,SPA-216,SPA-291,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/2/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,jmello,6/2/20 0:00,,,,,,,,,,,,,,,,,,cyarlagadda,,,,,SCORE-688,,,,,,,BB Production,,,,,,,,,,,,,1264730,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1750</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jmello,6/2/20 0:00,,,2|i0j83w:,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,3,,,,,Cape Cod Creme Brulee,Danish Denmark,,0,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"Set PassPatientCondition to false
{code:java} SS-SetLocalFeatureFlag AthenaNet PassPatientCondition {code}
Get valid test data for slotId, departmentId, providerId, patientId from sql for any context

1) Call the following endpoints
      1)\{base}/api/v1/internal/Appointment/adminBooking/bookingFromSlots
      2) \{base}/api/v1/internal/Appointment/adminBooking/modifiedBooking
      3) \{base}/api/v1/internal/Appointment/adminBooking/rescheduleWithPatientId
     4)\{base}/api/v1/internal/Appointment/adminBooking/rescheduleToModifiedSlot

with following extension.
{code:java}
	""extension"": [{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/isEmploymentRelated"",
				""valueBoolean"": true
	},
	{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/isRelatedToAutoAccident"",
				""valueBoolean"": true
	},
	{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/isRelatedToOtherAccident"",
				""valueBoolean"": true
	},
	{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/autoAccidentState"",
				""valuestring"": ""TX""
	},
	{
				""url"":""extension.scheduling.athena.io/appointment.athenanet/isAnotherPartyResponsible"",
				""valueBoolean"": true
	}]	
{code}
Ensure that it returns 200, Ensure that no fields in appointment table are updated as the feature flag is turned off. ",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[NEWBIE] Remove MappingConfiguration.Config section,SCORE-1723,1260379,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,jmello,jmello,5/27/20 16:33,6/19/20 9:45,6/24/20 17:27,6/18/20 13:00,,,0,,,,,,,,,,,,,,,"Previously the MappingConfiguration.Config section was used to only sync mappings for certain channels.  However, we now have functionality to enable/disable specific channels.  We should remove the now-deprecated MappingConfiguration.Config section, and all related code",,fmicle,jmello,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/18/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,redger,6/17/20 0:00,,,,,,,,,,,,,,,,,,fmicle,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1723</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-257,,,,,,,,,,,,,,,,,,,,1260379,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1723</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/18/20 0:00,,,2|i0ki5b:c,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"- Make sure branch (PR) builds and all tests pass
- Deploy this branch to Azure (SS-SetupSCORE or via Jenkins job)
- Navigate to the Configuration section for sched-{env}-scoreASEFunctions and change the value for SnowflakeExtractSchedule to  0 */10 * * * * (that will run the auto sync timer function every 10 minutes)
- Wait for the function to run and verify that your {env}_anet-auto-sync CosmosDB collection has been created
- Add an empty Config section (add this line: ""Config"": {},) to the MappingConfiguration document (this is the ""old"" schema, before the change in this PR)
- Wait for the function to run again and verify that your {env}_anet-auto-sync collection has been updated and the ""Config"" section has been deleted.
- SS-Clean",,,,,,,,,,,,,,0,,,,,"06/12/2020 12:58 PM;fmicle;starting here, this is what needs to be removed; https://bitbucket.athenahealth.com/projects/SCORE/repos/services/browse/src/Adapters/CosmosDB/AthenaNetAutoSync/CosmosDbAthenaNetAutoSyncRepository.cs#199-207
",06/17/2020 10:11 AM;redger;code looks fine.  your test plan doesn't exercise the code changes you made to the autosync document though,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"Manually set ""Telehealth Distant Site"" for NSA Client",SCORE-1722,1260326,Story,Blocked,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,midavis,midavis,5/27/20 15:41,6/23/20 14:11,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"*Prod Mirror ONLY*

context 11511

NSA clients do not have the appointment type mapping drop down.  Please add the below manually for them.  

 

Below you will find the appointment types for NSA client 11511.  These are the appointment types that we should have the Appointment Type Class updated.  I do not see appointment IDs in aNet, so I didn’t include them?

 
 * Q4U REMOTE PT Medicare Annual Wellness ESTABLISHED PT
 * Q4U REMOTE PT Medicare Annual Wellness NEW PT
 * Qure4U Patient Remote Telehealth
 * Qure4u IN OFFICE Telehealth ESTABLISHED PT
 * Qure4u IN OFFICE Telehealth NEW PT

*TEST in Prod Mirror*",,bbartle,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1722</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1260326,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1722</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpk:i,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,"06/18/2020 3:25 PM;midavis;[~bbartle] - I was mistaken about the intent of this request.  I thought they wanted this mapping added for billing purposes but it is to join the native telehealth beta.

What are your thoughts on native TH for an NSA client?

 

FYI [~keknight] [~redger] [~dacurtis] I've assigned this to myself and marked it as blocked until we re-eval our approach and options.  ","06/19/2020 8:37 AM;bbartle;Ok - I think we'd need to systematically go through all the telehealth features and test them

A couple potential complications:
 * The ""telehealth test mode checkbox"" triggered along side appointment type dropdowns. NSA modified a few of those dropdowns to be ""a canonical appointment type dropdown + a duration dropdown"" so we may need to do more work on the checkbox to either (a) make it work with NSA or (b) make it not break on NSA
 * I'm not sure what (if anything) messaging did differently off of NSA, but we'd need to make sure

My bigger concern is we'd be adding another front for telehealth to worry about, when the benefit would be limited to a small number of contexts (that would all require dev investment to onboard). Could we use this as motivation to bump the priority of ""clean up NSA""? We're going to have to do that at some point, and it is a constant thorn. 

 

 ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Auto-add contexts to auto-sync list,SCORE-1721,1260324,Story,New,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,dstrickland,dstrickland,5/27/20 15:39,6/18/20 10:53,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"To cut down on manual on-boarding work, we would like to automatically sync configs for contexts that have web scheduling configurations. As an initial pass, query snowflake for relevant context IDs, and add any missing contexts to the autosync list immediately before autosync runs. This should probably be done as a separate azure function under the autosync orchestrator. Long term, we may want to look into simply pulling the list of autosync contexts from snowflake, rather than maintaining our own list in cosmos.

For our purposes here, the contexts with web scheduling configurations should be defined as the set of unique contextIds from the ATHENANET_RAW_COMBINED.ALLCONTEXTS.APPOINTMENTTYPE table in snowflake, where APPOINTMENTTYPE.WEBSCHEDULABLEYN = Y and APPOINTMENTTYPE.DELETED is NULL.

We will need to test this rollout in a non-prod environment to verify that autosync won't choke on such a large addition.

The following concerns are out of scope:
 * Removing any contexts from the auto-sync list
 ** We may need to force a context into the autosync list, even if it's not in our snowflake query results
 ** If we need to turn off consumer scheduling for a context, that should be done with the disable booking channels endpoint, and autosync should generally be left on for the context.
 * Enabling/disabling booking channels automatically
 ** We want to start out with manual review of contexts which are getting enabled and disabled at this point. We can look into auto-enabling booking channels in another ticket if we want to do that later.
 ** This does mean that new consumer scheduling contexts still have to be manually set up. However, there's still value here, because changes to the autosync list don't take effect for 24 hours, whereas we can get immediate feedback on changes to the enabled booking channels.",,dstrickland,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1459,,,,,,,,,,,,,,,,"* All contexts with web scheduling configs (as defined in the description) automatically have those configs synced without requiring manual addition to the autosync list
 * See the concerns which are specifically out of scope in the description",,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1721</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-257,,,,,,,,,,,,,,,,,,,,1260324,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1721</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|hv0lg0:440009,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,,,,4,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Add sequence number to insurance plans on internal/patient GET endpoints,SCORE-1717,1260172,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,dterry,dterry,5/27/20 13:59,6/12/20 9:27,6/24/20 17:27,6/2/20 9:55,,,0,,,,,,,,,,,,,,,"SCORE-1434 allowed internal/patient GET endpoints (PortalReschedule, PortalRecommended, and new endpoint Practice) to return all insurances/coverages for the patient.

Add the sequence number to the Contained Coverages so FE can properly identify and order the different plans for display.",,dterry,jmello,,,,,,,,,,,,,,,,,,SPA-315,,,,,,,,,,,,,,,,,,,,,,"* FHIR Coverage objects have FHIR order property populated with the athenaNet sequence number
 * If there is no athenaNet sequence number, the patient insurance is a case policy.   The FHIR order property will be null, and there will be an extension on the coverage with the url ""extension.scheduling.athena.io/coverage.athenanet/iscasepolicy"" and a value of true.
 * Policies with a sequence number have a ""iscasepolicy"" extension value of false.
 * InsurancePlan resource type is removed, since its DisplayPlanName also appears in the neighboring Coverage resource.",,,,,,,,N/A,,,,,DISABLED,,midavis,6/1/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,jmello,6/1/20 0:00,,,,,,,,,,,,,,,,,,dterry,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1717</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-688,,,,,,,,,,,,,,,,,,,,1260172,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1717</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jmello,6/1/20 0:00,,,2|i0ijp0:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"Get a Patient and Verify the Insurances returned
 * Use the Internal Practice ""Patient - Get"" endpoint in Insomnia, and at the prompts enter:

 * 
 ** LocationId {color:#0747a6}432-2{color}
 ** PatientId {color:#0747a6}432-13867{color}
 * Observe 4 contained Coverages, in this order:
 ## BCBS
 ## Cigna
 ## Self Pay
 ## Covid-19
 * Observe in each Coverage:
 ** There is now an Order value. It will match the sequence number above, except the fourth policy will not have an Order because it doesn't have an MDP sequence number (it's a case policy).
 ** There is a new Extension for IsCasePolicy.
 For normal insurance plans, its value should be {color:#00875a}{{false}}{color}. (The first 3 plans)
 For Case Policies, it should be {color:#00875a}{{true}}{color}. (The last Covid plan)
 * Observe there is no longer a Contained resource type of InsurancePlan. The Contained objects should only be Coverage types for this patient.",,,,,,,,,,,,,,0,,,,,"05/27/2020 2:12 PM;jmello;[~dterry] One more thing: some patient insurances don't have a sequence number.  These are special types of insurances, called case policies.  I think they're non-standard insurances, like Worker's Comp in case you're injured on the job, or Auto Insurance.  I don't really know much else about them though - you should work with Radhika to figure out if case policies should be included","05/28/2020 11:10 AM;jmello;[~dterry] updated the acceptance criteria.  I spoke with Radhika and Thiagu, and we agreed that we should add an extension to identify case policies - see acceptance criteria for definition",05/29/2020 2:38 PM;jmello;Looks good!  Just one little comment,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[13014] Some Patient Info Endpoints Return Outdated Preferred Name Value,SCORE-1705,1256801,Bug,Coding,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,Medium,,dpark,ryburns,ryburns,5/22/20 9:16,6/22/20 11:46,6/24/20 17:27,,,,0,ProductKnowledge,,,,,,,,,,,,,,"[Client Facing]
*Context:* [13014]
*Department:* 21
*Patient:* 8677,8677

*Bug Description:*
The endpoints return the deprecated preferred first name field. They should instead be returning the First Name Used field from the quickview

*Replication Steps:*
Log into context 13014 department Corktown Health Clinic (dept id 21) as rburns38 or any user that can create appointments and access the MDP API Test page
Open the quickview for patient id 8664 (or any patient that has both the preferred first name and first name used field filled out)
Click the Scheduling Dropdown menu and select ""Schedule Appointment""
Find an open slot and schedule the patient - because this is specific to the appointments/changed endpoint the appointment date, time, type, provider, etc. don't matter. What's important is to add an appointment
Open the MDP API Test page Gear > Root > ""MDP API Test"" under More Disruption Please
Partner Select: Hale Health
Endpoint Search: GET /appointments/changed
Run the endpoint with ""showpatientdetail"": ""true"" and ""ignorerestrictions"" : ""true""
Note that ""preferredname"" is returned but ""altfirstname"" is not
Note that in the case where preferredfirstname = altfirstname this might be ok, but for patients like 8677 where the deprecated preferredfirstname field is not used, this causes the API to miss the patient's first name used

Run endpoint GET /patients with patient id 8677's dob and phone number (not listed here because of PHI concerns)
Note that no altfirstname is returned

*API Endpoints:*
get /appointments/changed, get /patients

*Known Workarounds:*
Use GET /patients/&#123;patientid&#125; to pull the field after utilizing one of the other endpoints

*Client Impact:*
The ""preferred name"" field (which is very clearly marked as discontinued and not to be used from the athenaNet front end) is no longer being used, so using the athenaNet front end as intended causes the endpoint to return incorrect information.

This is especially bad for organizations that see transgender patients where the ""preferred name"" is not simply a nickname but the name that should be used in patient communications.

Note that this issue is NOT context specific, but 13014 has been specifically mentioned by the MDP partner because of the high volume of transgender patients they see.
",,ryburns,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,P4 Production,,,,,,,,,,,,,1256801,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1705</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i00xq4:zzzz,,GA,,,,,,,,,,,None,None,<Text here>,,,10650189,,,,,,,,,3,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,"05/22/2020 9:16 AM;ryburns;Task created via '[bug triage|https://devnet.athenahealth.com/bug_triage]'

Originally sent to 'Scheduling: Core Architecture'.

",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Create CPSW Web API application,SCORE-1700,1256103,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,5/21/20 15:08,6/12/20 9:31,6/24/20 17:27,5/29/20 9:09,,,0,,,,,,,,,,,,,,,"* create the barebones web api
 * only thing it should do is expose a swagger
 * deploy with RM-Setup

 

Blocked until https://athenajira.athenahealth.com/browse/SCORE-1699 is complete.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,5/28/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,fmicle,5/28/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1700</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1374,,,,,,,,,,,,,,,,,,,,1256103,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1700</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,fmicle,5/28/20 0:00,fmicle,5/28/20 0:00,2|i0i8ke:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* 
{code:java}
Import-Module -Force RM.psm1
RM-Setup{code}

 * access your CPSW web api, e.g. [https://rm-rbe-cpsw.scheduling.nonprod.athena.io/swagger/index.html]
 ** verify swagger populates with a single endpoint (it does nothing currently)
 * access your CPSW health endpoint, e.g. [https://rm-rbe-cpsw.scheduling.nonprod.athena.io/health]
 ** the first time it might return ""Degraded""
 ** subsequent tries should return ""Healthy""
 * once the Analyzers PR is merged, tell Robert and he will update the nuget package and remove the pragma suppressions for APIController",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Check Permissions in SCORE,SCORE-1698,1256096,Story,Deploying,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,redger,midavis,midavis,5/21/20 15:05,6/23/20 14:10,6/24/20 17:27,6/23/20 10:41,,,0,,,,,,,,,,,,,,,"See attached confluence page for spec.

 ",,midavis,,,,,,,,,,,,,,,,,,,SCORE-1683,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/22/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,dterry,6/22/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1698</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1807,,,,,,,,,,,,,,,,,,,,1256096,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1698</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dterry,6/22/20 0:00,dterry,6/22/20 0:00,2|i0lcpl:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,3.5,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"codechecker: verify the permissions used in the requests match the [confluence document|https://athenaconfluence.athenahealth.com/display/SCHEDULE/Roles+and+Permission+Map]

 
 * follow test plan from SCORE-1697 but target MAINSTG1 instead of MAINFTR1
 * 
{code:java}
SS-UseAthenaNetDevServer -devServer devmain-stage -port 443{code}

 * set your insomnia local settings file to have yourself as the AthenaNetUser and the context to be 432
 * start your web api
 * in insomnia, internal->practice->search schedules
 ** verify you get a 200 response
 * using sql++, find a user that does not have root access:
{code:java}
select * from useraccess u1 where contextid=432 and not exists (SELECT NULL FROM useraccess u2 where u1.username=u2.username and u1.contextid=u2.contextid and u2.roleid=1) and rownum < 10;{code}

 * change your username in your insomnia local settings file to be that user
 * execute the request again
 ** verify 200
 * SS-SetLocalFeatureFlag to set the permission check to ""true""
 * execute the request again
 ** you should get Forbidden (user doesn't have any of the required permissions)
 * log in to devmain-stage, context 432
 * Gear->User->Users
 * search for the user you found earlier
 * click ""Update""
 * click ""Roles""
 * click ""Edit""
 * search the list for Practice Calendar
 * select the ""Practice Calendar: Scheduler"" role
 * click ""Save""
 * stop and restart your web api (user permissions are stored in memcache for a short time)
 * execute the endpoint again
 ** you should get a 200
 * remove the Scheduler Role and grant the View Only role
 * stop and restart again
 * use the endpoint again
 ** verify success
 * try to use Internal->Practice->Appointment - Cancel (any valid input)
 ** verify you get forbidden",,,,,,,,,,,,,,0,,,,,06/22/2020 4:56 PM;redger;assigning to myself until SUA-1424 merges,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Create Roles & Permissions in aNet,SCORE-1697,1256095,Story,Patching,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,midavis,midavis,5/21/20 15:05,6/22/20 10:06,6/24/20 17:27,6/22/20 10:06,,,0,,,,,,,,,,,,,,,"See referenced confluence page for list of new roles and permissions

Use 
""siteuseradmin"" as gate to add/remove these permission from other users
 ",,dhalperin,midavis,svcjir_build,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,06/10/2020 11:25 AM;redger;role_permission.csv;https://athenajira.athenahealth.com/secure/attachment/571123/role_permission.csv,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/12/20 0:00,,,,,,,,,,,,,,3968119,3968136,,,,,,,,,dpark,6/11/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1697</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1807,,,,,,,,,,,,,,,,,,,,1256095,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1697</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dpark,6/11/20 0:00,,,2|i0ki5a:i,,GA,,,,,,,,,,,None,None,,,,,,,,,,mgerman,6/17/20 0:00,,,,,,,Danish Denmark,,,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,bbartle,6/15/20 0:00,,"* sync branch
 * $ATHENA_HOME/scripts/schema/user/generate_roles_and_permissions.pl MAINFTR1 --username <your username>
 * $ATHENA_HOME/scripts/schema/refresh_snapshots.pl --masterroot $MASTER_ROOT_INSTANCE --tables ROLE,PERMISSION,ROLEPERMISSION
 * harr your dev server
 * log in to anet
 * Gear->User->Role/Permission Finder
 * Search Role Name=Practice Calendar
 * verify role names, permission names, and permission descriptions match up with [the confluence document|https://athenaconfluence.athenahealth.com/pages/viewpage.action?spaceKey=SCHEDULE&title=Roles+and+Permission+Map]",,,,,,,,,,,,,,0,,,,,06/10/2020 11:25 AM;redger;[~midavis] attached you will find the export of the roles and permission from athenanet that you can match up against the confluence document,"06/12/2020 9:52 AM;redger;technical implementation signoff, please","06/15/2020 9:32 AM;redger;Security signoff, please",06/15/2020 9:38 AM;dhalperin;[~redger] I haven't been on SecDev for years,"06/15/2020 9:40 AM;redger;my apologies [~dhalperin], you're listed in the group of people when you click the ""[Security]"" link above. i'll try another person from that list","06/15/2020 9:40 AM;redger;are you able to provide Security signoff, [~mgerman]?",06/22/2020 10:06 AM;svcjir_build;Moving issue to Patching on behalf of redger's run of copy_up,,,,,,,,,,,,,,,,,,,,,,,,,,
 Add patient condition as part of the FORCE SLOT  ,SCORE-1695,1256060,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,midavis,midavis,5/21/20 14:34,6/12/20 9:27,6/24/20 17:27,6/9/20 14:44,,,0,,,,,,,,,,,,,,,,,midavis,,,,,,,,,,,,,,,,,,,,,,,SPA-347,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/8/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,redger,6/8/20 0:00,,,,,,,,,,,,,,,,,,cyarlagadda,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1695</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-688,,,,,,,,,,,,,,,,,,,,1256060,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1695</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/8/20 0:00,,,2|i0i8kg:c,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"sync into anet branch score-1744
Harr into feature
Run {code:java} SS-UseAthenaNetDevServer {code}
Set feature flag {code:java} score-mdp-pass-patientcond-forceSlot {code} to true
1) Call the following api with the extension
{{ SCOREWebAPIHost }}/api/v1/internal/Appointment/forcedBookingWithPatientId
{code:java}
	""extension"": [{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/isEmploymentRelated"",
				""valueBoolean"": true
	},
	{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/isRelatedToAutoAccident"",
				""valueBoolean"": true
	},
	{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/isRelatedToOtherAccident"",
				""valueBoolean"": true
	},
	{
				""url"": ""extension.scheduling.athena.io/appointment.athenanet/autoAccidentState"",
				""valuestring"": ""TX""
	},
	{
				""url"":""extension.scheduling.athena.io/appointment.athenanet/isAnotherPartyResponsible"",
				""valueBoolean"": true
	}]
{code}
Ensure that it returns 200. 
Get the id of booked appointment using the below query
{code:java}
select id from appoinment where status = 'f' and lastmodifed > '2020-06-04' and lastmodifiedby = 'username'; 
{code}

Ensure that the patient condition fields are updated. 
2) Call the above api with no extensions ensure that it returns 200 and patient condition fields are updated as below.
{code:java}
RELATEDTOEMPLOYMENTYN: N
RELATEDTOAUTOACCIDENTYN:N
RELATEDTOOTHERACCIDENTYN:N
ANOTHERPARTYRESPONSIBLEYN:N
{code}
3) Unharr and do not use AthenaNetDevServer
Set feature flag {code:java} score-mdp-pass-patientcond-forceSlot {code} to false
Call the above api and ensure that is returns 200 and does not update patient condition fields.
",,,,,,,,,,,,,,0,,,,,05/27/2020 1:49 PM;redger;extensions created in SCORE-1200,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
SPIKE - ImportAppointment calls causing high WorkerBacklog count,SCORE-1692,1255997,Bug,Done,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,gdawson,gdawson,5/21/20 13:56,6/12/20 13:41,6/24/20 17:27,6/12/20 13:41,,,0,,,,,,,,,,,,,,,"There seem to be a large number of ImportAppointment calls for context 20300 (importing appointments from 2017, 2018, 2019?)

{noformat}
[05/21/2020 00:01:39 job4292.athenahealth.com DB1 271025] {""META"":{""LEVEL"":""info""},""DATA"":{""USERNAME"":""sbhusal1.42"",""CONTEXTID"":""20300"",""LOCALSTARTDATE"":""09\/09\/2019"",""CAPPEDENDDATE"":""09\/09\/2019"",""EVENT"":""APPOINTMENT::BOOKED"",""DEPART
MENTPROVIDERMAP"":{""24"":{""10"":1}},""FUNCTION"":""Athena::Appointment::API::Appointment::ImportAppointment"",""LOCALENDDATE"":""09\/09\/2019""}}
{noformat}

Again on 5/24:

{noformat}
[05/24/2020 03:47:04 job4161.athenahealth.com DB1 443188] {""META"":{""LEVEL"":""info""},""DATA"":{""USERNAME"":""sbhusal1.44"",""CONTEXTID"":""20300"",""LOCALSTARTDATE"":""09\/25\/2017"",""CAPPEDENDDATE"":""09\/25\/2017"",""EVENT"":""APPOINTMENT::BOOKED"",""DEPARTMENTPROVIDERMAP"":{""24"":{""12"":1}},""FUNCTION"":""Athena::Appointment::API::Appointment::ImportAppointment"",""LOCALENDDATE"":""09\/25\/2017""}}
[05/24/2020 03:47:04 job4161.athenahealth.com DB1 443187] {""META"":{""LEVEL"":""info""},""DATA"":{""USERNAME"":""sbhusal1.44"",""CONTEXTID"":""20300"",""LOCALSTARTDATE"":""03\/13\/2018"",""CAPPEDENDDATE"":""03\/13\/2018"",""EVENT"":""APPOINTMENT::BOOKED"",""DEPARTMENTPROVIDERMAP"":{""25"":{""25"":1}},""FUNCTION"":""Athena::Appointment::API::Appointment::ImportAppointment"",""LOCALENDDATE"":""03\/13\/2018""}}
[05/24/2020 03:47:04 job4161.athenahealth.com DB1 443189] {""META"":{""LEVEL"":""info""},""DATA"":{""USERNAME"":""sbhusal1.44"",""CONTEXTID"":""20300"",""LOCALSTARTDATE"":""05\/02\/2017"",""CAPPEDENDDATE"":""05\/02\/2017"",""EVENT"":""APPOINTMENT::BOOKED"",""DEPARTMENTPROVIDERMAP"":{""24"":{""10"":1}},""FUNCTION"":""Athena::Appointment::API::Appointment::ImportAppointment"",""LOCALENDDATE"":""05\/02\/2017""}}
{noformat}",,dstrickland,gdawson,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1823,SCORE-1706,SCORE-1686,,,,INCIDENT-2290,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,dstrickland,,,,,,,,,,,,P4 Production,,,,,,,,,,,,,1255997,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1692</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0i8kh:y,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,3,,,,,Cape Cod Creme Brulee,Danish Denmark,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,06/11/2020 12:09 PM;dstrickland;SCORE-1823 opened with an implementation plan.,06/12/2020 9:28 AM;gdawson;[~dstrickland] Is there anything to review on this? Or just that SCORE-1823 is opened?,"06/12/2020 1:15 PM;dstrickland;[~gdawson], just that SCORE-1823 is opened and makes sense. Feel free to move it to done if it looks OK to you. I just wanted to put it in review to give y'all a chance to ask me questions if you had any. ",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Pass event date to MDP /auditpageview,SCORE-1690,1255892,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,5/21/20 12:41,6/19/20 9:45,6/24/20 17:27,6/16/20 11:58,,,0,,,,,,,,,,,,,,,"SCORE-1676 implemented a new MDP endpoint (/auditpageview) that accepts page view audits and passes them through the existing athenaNet page view audit process:
 * AthenaSecurity::Log::QueueAuditNote()
 ** audit is pushed to a class variable that is flushed periodically
 * AthenaSecurity::Log::FlushAuditNotes()
 ** audits from the class variable are read and written to scribe
 * /prod/perllib/Athena/Platform/PopulatePageView.pm starts a daemon
 ** the daemon picks up logs from the scribe log and inserts them into the database
 ** the CREATED field for PAGEVIEW table is scraped from the scribe log's entry time

we want to be able to pass our own event timestamp, because the time that we send the event to MDP may be some time after the event occurred.  

Option 1
 * alter the daemon such that it will read the timestamp from the NOTE field if it exists, replacing the scribe timestamp if necessary
 * this is kinda hacky and relies on string matching, but is probably the least amount of work

Option 2
 * alter the daemon such that it will accept both the old log format and the new log format (same as before but with the addition of a CREATED field)
 * the scribe logs are just CSV, so it would be difficult to do this in a way that is backwards compatible.

Option 3
 * perform the database insert into the PAGEVIEW table within the MDP API module
 * putting business logic in the MDP layer is frowned upon, but realistically this won't be used anywhere else

Option 4
 * use an existing subsystem and add a new API call to insert directly into the PAGEVIEW table
 * which subsystem does this belong in?  there's one called Report, but none of the other subs in that module are about logging events - it's used for generating reports.

Option 5
 * create a new subsystem
 * who knows how to create a subystem?

 

make sure to find any other side effects that were occurring in the original code path and make sure we are duplicating those",,fmicle,,,,,,,,,,,,,,,,,,,SCORE-1805,,,,,,,,,,,,,05/29/2020 12:37 PM;svcjir_verifycode;verify_code_2020-05-29-13:37.html;https://athenajira.athenahealth.com/secure/attachment/562696/verify_code_2020-05-29-13%3A37.html,05/29/2020 1:01 PM;svcjir_verifycode;verify_code_2020-05-29-14:01.html;https://athenajira.athenahealth.com/secure/attachment/562704/verify_code_2020-05-29-14%3A01.html,05/29/2020 3:05 PM;svcjir_verifycode;verify_code_2020-05-29-16:05.html;https://athenajira.athenahealth.com/secure/attachment/562844/verify_code_2020-05-29-16%3A05.html,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/16/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,fmicle,6/16/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1690</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1587,,,,,,,,,,,,,,,,,,,,1255892,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1690</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,fmicle,6/15/20 0:00,,,2|i0huh8:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,5,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* check out the anet code from the subtask and harr a dev server

{code:java}
SS-SetupSCORE
SS-UseAthenaNetDevServer{code}
 * SS-SaturateServiceBus
 * wait...
 * when it finishes, go and query the pageview table in athenanet and verify you see recent entries
{code:java}
SELECT * 
FROM PAGEVIEW 
WHERE CREATED > to_date(?) AND CREATEDBY='test' 
ORDER BY CREATED DESC;
{code}

 ",,,,,,,,,,,,,,0,,,,,06/15/2020 4:04 PM;fmicle;Just one quick documentation comment that needs to be fixed.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Allow front end to get users's permissions,SCORE-1683,1254520,Story,Deploying,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,midavis,midavis,5/20/20 10:24,6/23/20 14:10,6/24/20 17:27,6/23/20 11:20,,,0,,,,,,,,,,,,,,,"The front end application will need to hide buttons and workflows from people depending on their level of access.

Ideas suggested:
 * Allow front end to inspect token
 * New endpoint to list users's permissions",,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/23/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,jpickens,6/22/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1683</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1807,,,,,,,,,,,,,,,,,,,,1254520,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1683</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jpickens,6/22/20 0:00,,,2|i0lcpl:i,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,4,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* import new insomnia file
 * set the username in your insomnia local settings file to your username
 * launch web api
 * use new endpoint, Token => Get User Permissions
 ** verify true for all permissions
 * change the username to something bogus, e.g. ""xxx""
 * execute again
 ** verify false for all permissions
 * launch swagger - [https://localhost:5001/swagger]
 * find the new endpoint
 * verify it has a response example that matches the format that you got back from insomnia (a dictionary of strings to bools)",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Clean up anet feature toggle for SCORE-904,SCORE-1664,1250772,Story,Code Review,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,redger,redger,5/18/20 10:51,6/23/20 14:13,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-904,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,3985978,,,,,,,,,,,,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1664</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1587,,,,,,,,,,,,,,,,,,,,1250772,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1664</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpl:qz,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,1,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* use test plan from SCORE-904 (ignoring the part about the feature toggle, it doesn't exist any more)",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
AthenaNetFhirSlotId regex doesn't match correctly,SCORE-1650,1247914,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,5/14/20 13:13,6/19/20 9:45,6/24/20 17:27,6/15/20 11:33,,,0,,,,,,,,,,,,,,,"we use:

""^([\d-]+).(\d+)$""

which will match things like:

14417.1234

14417-.1234

14417-1-.1234

this regex should be more restrictive, such that it requires:

contextId-departmentId-providerId.appointmentId",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/15/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,redger,6/15/20 0:00,,,,,,,,,,,,,,,,,,jhilder,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1650</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1247914,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1650</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/15/20 0:00,,,2|i0l37d:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Fix MDPCallContext for broken endpoints,SCORE-1649,1247838,Story,Testing,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,fmicle,redger,redger,5/14/20 12:28,6/24/20 16:39,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"The error that was being thrown when session user is provided was fixed in mdp in SCORE-904.  Once that patches and the rollout toggle is turned on, then alter the methods in the MDPClient to pass MDPCallContext.User for the following endpoints:

 PUT appointments/\{id}/cancel

PUT appointments/\{id}/cancelForSchedulingUser

PUT appointments/\{id}/schedulinguser (in MDPClient.TryBookAthenaNetAppointmentAsync)

 
----
 

search for SCORE-1646 and SCORE-1649 in code and replace ""Service"" with ""User"" context.",,,,,,,,,,,,,,,,,,,,,,,,,,,SCORE-1648,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,fmicle,6/24/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1649</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1587,,,,,,,,,,,,,,,,,,,,1247838,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1649</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpl:k,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* setup score
 * ss-setlocalfeatureflag for ""score-mdp-pass-session-user"" to ""true""
 * run the web api
 * find a booked appointment in sql++
{code:java}
SELECT a.id as appointmentid, a.departmentid, p.id as providerid, a.patientid FROM Appointment a inner join provider p on p.name=a.staffusername where a.status= 'f' and rownum<10 and appointmentdate > sysdate;
{code}

 * using insomnia Practice->Cancel, cancel the appointment
 ** verify success
 ** query the appointment again, ensure CANCELLEDBY is the username in your local insomnia settings file
 * using insomnia Practice -> Force Book, create a slot and book an appointment
 ** verify success
 ** find the appointment you just created:
{code:java}
 SELECT * FROM APPOINTMENT WHERE SCHEDULEDBY=? AND CREATEDBY= ? and appointmentdate = trunc(sysdate);{code}

 * 
 ** scheduledby/createdby should both be the username in your local insomnia settings file
 * use Insomnia Consumer -> Appointment - Book With Demographics (chained)
 ** verify success",,,,,,,,,,,,,,0,,,,,05/21/2020 4:15 PM;redger;blocked until SCORE-904 goes to production and the rollout toggle is on,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Review MDP appointments/open call for optimization,SCORE-1634,1245132,Story,Deferred,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,jmello,achen,achen,5/12/20 17:02,6/24/20 11:42,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"Platform custodian: https://devnet.athenahealth.com/platform_custodian/sql/id/495

Tied to #incident-2247 - some problems with this endpoint on 19538, perhaps due to high usage. However, we should see if this query could be optimized so that it can handle higher volume.

Look at what the high volume calls were using as parameters.

This is also a nice MDP dashboard I found in Kibana: https://kibana.athenahealth.com/goto/7c12bab7e5cebd78dc0752eadaa36782

Should work with API Design team / Emma Behnke on helping Phreesia use this endpoint more efficiently.

---
Devro sqlstats link suggests that optimizations can be made:
https://devro.athenahealth.com/1/1/athenaroot/sqlstats.esp?CSRFPROTECT=473e49f91827419c68ba63dac0745374&INSTANCE=DB41&DATE=05%2F12%2F2020&STARTHOUR=16&STARTMINUTES=0&ENDHOUR=17&ENDMINUTES=0&ORDERBY=BUFFER_GETS&LIMIT=50&MINEXECUTIONS=1&checkbox_yesno_USESTANDBY=1&USESTANDBY=1&SUBMIT=Submit&APWAIT=&BUFFER_GETS=1&CCWAIT=&CELL_UNCOMPRESSED_BYTES=&CLWAIT=&CPU_TIME=1&DIRECT_WRITES=&DISK_READS=1&ELAPSED_TIME=1&END_OF_FETCH_COUNT=&EXECUTIONS=1&FETCHES=&INVALIDATIONS=&IOWAIT=&IO_INTERCONNECT_BYTES=&IO_OFFLOAD_ELIG_BYTES=&IO_OFFLOAD_RETURN_BYTES=&JAVEXEC_TIME=&LOADS=&OPTIMIZED_PHYSICAL_READS=&PARSE_CALLS=&PHYSICAL_READ_BYTES=&PHYSICAL_READ_REQUESTS=&PHYSICAL_WRITE_BYTES=1&PHYSICAL_WRITE_REQUESTS=&PLSEXEC_TIME=&PX_SERVERS_EXECS=&ROWS_PROCESSED=1&SORTS=

The avg buffer gets is above 100,000, so that's usually a good rule of thumb for indicating that this is using too many buffers, and that we should be able to get the query under this significantly.

The appearance of two rows with very similar queries and exactly the same execution count also suggests that somehow this endpoint is making 2 large queries each endpoint call. That doesn't seem right.

",,achen,crrogers,csinotte,dstrickland,ebehnke,jepatterson,jmello,,,,,,,,,,,,,,,,,,,NOC-24402,,,,,,INCIDENT-2247,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1634</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1245132,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1634</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|hv0k78:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,External Dependencies,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,05/12/2020 5:06 PM;achen;[~ebehnke] - please help SCORE team with this endpoint and understanding what Phreesia may be attempting to do with it. We should also review for optimizations for the query in case this is not performing optimally with the parameters they are passing in.,05/12/2020 5:13 PM;achen;[~jmello] - this may be very similar to what we did for the appointments/booked/multidepartment endpoint,"05/12/2020 5:46 PM;dstrickland;I dug into the underlying code a bit. It looks like a more performant endpoint already exists called /appointments/enhancedopen. We will want to understand their usecase and make sure /enhancedopen covers it, but they might be able to simply migrate to the new endpoint.

 

appointments/open calls into Appointment::GetOpenAppointments, which is a (rather thick) wrapper around PatientCycle::GetOpenAppointments. I'm sure there are a number of potential performance improvements we could make there, but it's legacy code and we would need to proceed very carefully.","05/18/2020 1:21 PM;crrogers;[~achen]

I have reached out to Phreesia and brought their DB, [~jbickford] into the conversation as well. I have yet to hear back at this time. 

Having said that, Phreesia and several other MDP Partners have been creating support cases for receiving 503's for seemingly no reason. [~ryburns] and I discussed this issue and were unable to come up with an explanation and SCORE-1110 was submitted for further investigation. Given this Incident, it now appears to me that these errors are likely ties to CPU over-usage on specific stacks in which those 503's are returned. As of now, most partners approach to resolving this issue are to resubmit the same call until successful, which is likely why there was such a high volume of these calls once the 503's were received. I could see this exacerbating the issue, but not being the cause of the underlying issue if this is in fact the case. 

Is this something you could help us to further investigate? ","05/21/2020 3:04 PM;jmello;The query hasn't shown up in even the top 400 worst queries by buffer get in the last ~week.  I see that statistics were last analyzed on APPOINTMENT on 19538 on 05/16, about when things got better.  I haven't seen anything else in the query plan that would explain the bad performance

[~crrogers]  Thanks for working with the client on this.  The 503s you mention seem to be a different, larger issue.  Given that the query is now performing fine, and SCORE-1110 has been submitted for the 503s issue, would you oppose me closing this ticket?  

[~achen] any objections to me closing this ticket?

Thanks, Julianna",05/26/2020 8:24 AM;jepatterson;[~crrogers] [~achen]  Please let us know what else is needed outside of the SCORE tickets that have been submitted this time?  ,"05/27/2020 9:07 AM;achen;no, we can defer this for now. I think if this re-occurs, it means that stats can get stale on this table easily and we would want to hint the query to help it choose a good plan when that occurs.",,,,,,,,,,,,,,,,,,,,,,,,,,
Update MDP appointment subscription to include mapping changes,SCORE-1621,1242411,Story,Designing,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,midavis,midavis,midavis,5/11/20 15:43,6/23/20 14:17,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"h2. Allow the ability to pickup appointment type changes via appointments change API subscriptoin endpoint
Description of issue and challenges:
Currently the appointments/changed/subscription endpoints do not capture appointment type changes made when using PUT /appointments/booked/\{appointmentid}
.
The workaround for this is to cancel the appointment and reschedule a new appointment with the new appointment type. This is not an efficient workflow and can lead to skewed appointment cancellation rates for the practice as well as increased call volumes to the API. If this workaround is not utilized the change is not caught in the appointments changed subscription and cannot be fed to downstream systems, for example telehealth partners.

Appointment type updates are utilized during daily practice workflows and this enhancement will certainly benefit these scenarios due to the current workaround described above. However, we are seeing a specific scenario that emphasizes the need for our appointment type updates to trigger an event in the appointment changed subscription endpoint. Due to COVID-19 social distancing restrictions many practices are moving to virtual appointments and we are seeing practices requiring the ability to mass update appointments to a virtual appointment type to later feed into a telehealth partner integration. Without the ability to capture these changes in an appointment changed subscription feed they are required to utilize the workaround listed above, which on a mass scale becomes even more inefficient.

Proposed Change:
Allow updates made to appointment types the ability to trigger a qualifying changed data event that would be captured by our GET appointments/changed subscription endpoint.",,kdakoulas,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,06/16/2020 2:26 PM;kdakoulas;Appointment_Change_TestCases.docx;https://athenajira.athenahealth.com/secure/attachment/574639/Appointment_Change_TestCases.docx,06/16/2020 2:28 PM;kdakoulas;Appointments Changed usage - ALL.xlsx;https://athenajira.athenahealth.com/secure/attachment/574641/Appointments+Changed+usage+-+ALL.xlsx,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1621</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1242411,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1621</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|hv0lg0:4400r,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,"06/11/2020 2:10 PM;midavis;Clarify what should trigger this broadcoast
 * a change to appt type after its been booked
 * a change to the apt type mapping
 * Traffic estimation

[~dpark] - please pause work until I can review the above.  ","06/16/2020 9:33 AM;midavis;[~kdakoulas] please see above. 

 

This should trigger an update:
 * For *booked* appointments only *IF* there is a change to the *appt type mapping*.","06/16/2020 2:28 PM;kdakoulas;The following updates to appointments should trigger an event for the updateappointment event type for our appointments changed subscription functionality.
 * For booked appointments if appointmenttypeid is changed via API (PUT /appointments/booked/\{appointmentid}).
 * For booked appointments if providerid is changed via API (PUT /appointments/booked/\{appointmentid}).
 * For booked appointments if notetext is changed via API (POST /appointments/\{appointmentid}/notes & PUT /appointments/\{appointmentid}/notes/\{noteid})

 

If all of the above data elements (appointment type, rendering provider, Notes/Reasons) are updated via the UI they correctly trigger an updateappointment event when calling GET /appointments/changed. If any of these fields are updated via the API no event is triggered. The API should be matching UI functionality. 

While this was reported by Millennium Physician Group and MDP Partner QueueDr. The amount of partners and clients that are impacted by this are all users of these the appointment subscription endpoints as they are missing updated data made via the API.

 

I have attached two documents
 # All test scenarios that I have tested in prod mirror (1959)
 # All impacted MDP partners and clients. (List of clients and partners utilizing the appointment changed endpoints).
 ** 200+ Partners
 ** 8,000+ Clients
 ** [https://tableau101/t/IntegrationServices/views/APIEndpointActivity/APICallActivityReference?:isGuestRedirectFromVizportal=y&:embed=y]

 ","06/16/2020 3:23 PM;midavis;Thank you for responding so quickly and thoroughly [~kdakoulas]

Quick clarification - the scenario's you laid out above don't include ""appointment type mapping"" change.  That may work now, as it seems changes from the UI work but not API.  Currently you can't change appointment type mapping via API.

 

 ","06/16/2020 7:33 PM;kdakoulas;Hi [~midavis], I am not sure I know what you are referring to with ""appointment type mapping"" change. 

IOCOL-1066 was originally submitted to surface an issue with changing an appointment type that is tied to a specific booked appointment.  Meaning an appointment was booked with appointment type A and is then updated with the API to appointment type B.","06/17/2020 11:27 AM;midavis;[~kdakoulas] - Interesting.  Somehow this got flagged as COVID related so I assumed it was for the new ""Telehealth Distant Site"" work we did on an existing mapping drop down.  Any idea how this got tied up with COVID work?",06/19/2020 9:15 AM;midavis;FYI [~kdakoulas] bumping this up again ^,"06/23/2020 12:53 PM;kdakoulas;[~midavis], The scenario that caused ICOL-1066 to be submitted was due to a new feature MDP partner QueueDr released in response to COVID, I believe it is called ""Switch"". It essentially is a script they run that checks for all practice appointments within a  specified timeframe and switches the appointment type to virtual/telehealth. Due to the nature of virtual visits the client was also integrated with one of our MDP telehealth partners who was not receiving these updates since, as I have described, the appointments changed subscription does not catch appointment type changes.

I cannot say for certain why this got flagged as COVID work but it could have been due to the conditions that led up to this request.",,,,,,,,,,,,,,,,,,,,,,,,,
Process SCORE audit queue,SCORE-1593,1238579,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,5/6/20 15:50,6/17/20 11:35,6/24/20 17:27,6/5/20 10:08,,,0,,,,,,,,,,,,,,,"* pull batches off of the queue and send them to MDP for permanent storage.  
 * create dead-letter alerting, identify what to do with events in the dead-letter queue
 ** do we operationalize it so that dead-letter events are automatically retried at a later point in time?  do we have the on-call developer of the week manually trigger a retry of dead-letter events?",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/4/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,dstrickland,5/29/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1593</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1587,,,,,,,,,,,,,,,,,,,,1238579,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1593</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jmello,6/4/20 0:00,,,2|i0hmr8:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"h2. Test SCORE -> MDP
 * SS-SetupSCORE
 * harr a dev server with the code from SCORE-1590
 ** 5/27 - code merged to devmain, you can use that instead of harring your own server
 * SS-UseAthenaNetDevServer
 * SS-SaturateServiceBus
 * wait until it finishes
 * tail your anet dev server scribe log and verify you see a bunch of audits show up:
{code:java}
# make sure you change MAINFTR1 to whatever your MASTER_ROOT_INSTANCE is, if different
tail -f /var/log/scribe/pageview-MAINFTR1/pageview-MAINFTR1_current{code}

h2. Test Deadletter Handling
 * download the [servicebug nuget package|https://www.nuget.org/api/v2/package/WindowsAzure.ServiceBus/6.0.1]
 * rename to .zip, extract the lib/net462/Microsoft.ServiceBus.dll file
 * copy the primary connection string for [service bus|https://portal.azure.com/#@prodathenahealth.onmicrosoft.com/resource/subscriptions/c068c3ec-4fc4-4822-993c-073af116477e/resourceGroups/SchedulingGlobalResources/providers/Microsoft.ServiceBus/namespaces/sched-master-audit-primary/saskey]
 * open powershell
 * send a bogus message to your audit queue, which will get deadlettered:
 * 
{code:java}
Import-Module Microsoft.ServiceBus.dll

# replace <envKey> with your own environment key
$ConnectionString = ""copied from azure portal"" + "";EntityPath=<enKey>-anet-read-audit""
$QueueClient = [Microsoft.ServiceBus.Messaging.QueueClient]::CreateFromConnectionString($ConnectionString)

$Encoding = [system.Text.Encoding]::UTF8
$UTF8String= $Encoding.GetBytes($String)
$MemoryStream = New-Object IO.MemoryStream -ArgumentList $UTF8String,$true#Create instance of Service Bus message object add memory stream
$Message =  New-Object Microsoft.ServiceBus.Messaging.BrokeredMessage -ArgumentList $MemoryStream
$Message.MessageId = [Guid]::NewGuid()

#Finally fire off the message to Service Bus
$QueueClient.Send($Message){code}

 * SS-BootstrapSCOREToolingLocalSettings
 * start up the ServiceBusQueueManager project in the Tooling solution (just debug the project is fine - no parameters required)
 * select your queue when prompted
 * verify it lists at least one deadletter message (or however many times you executed the block of code above)
 * choose option 1
 * choose your queue again
 * verify one deadletter message exists again (you moved it back to the active queue, but it's still a bogus message, and gets deadlettered again)
 * select option 2 to iterate the deadletter queue
 * select option 1 to delete the message
 * select your queue again
 * it should be empty",,,,,,,,,,,,,,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Update all write-able MDP endpoints in SCORE to pass sessionUser,SCORE-1589,1238572,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,redger,redger,5/6/20 15:44,6/17/20 11:35,6/24/20 17:27,6/1/20 11:16,,,0,,,,,,,,,,,,,,,"*would work:* for all endpoints that make modification in athenaNet, accept an AthenaNetUserName as an argument and pass it through to MDP.  Regression test all endpoints modified. 

*better*: create an ""AthenaNetUserNameProvider"" adapter that will glean the logged in user from the session.  if the user name is known (Practice workflow, Content Admin workflow),  automatically pass it along for *all* MDP calls.  remove ""userName"" arguments for all existing SCORE MDP adapter methods, instead relying on the provider.  in this way it won't be possible for someone to accidentally forget to send user name when it is known.  the caveat, though, is that if there are endpoints where passing ""sessionUser"" breaks something in MDP, we might not know about it if we don't test with an authenticated workflow.

File followup stories to address any endpoints which did not play nicely with sessionuser, first in MDP, then again in SCORE.",,dstrickland,jmello,,,,,,,,,,,,,,,,,INCIDENT-2357,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,5/29/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,jmello,5/26/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1589</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1587,,,,,,,,,,,,,,,,,,,,1238572,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1589</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,dstrickland,5/29/20 0:00,,,2|i0fofg:,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,5,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"h2. SCORE
 * SS-SetLocalFeatureFlag  ""score-mdp-pass-session-user"" to ""true""
 * use any external workflow (e.g Consumer) to search for slots and book an appointment
 ** find the appointment in prodmirror (search for patient -> Scheduling -> View Patient Appointments)
 ** click ""Audit History""
 ** verify the appointment was modified by the API user
 * use the Practice workflow to search for slots and book an appointment
 ** find the appointment in prodmirror
 ** click ""Audit History""
 ** verify the appointment was modified by the username in your local insomnia settings file
 * use the Practice workflow to cancel an existing appointment
 * Use the Portal workflow to search for slots and book an appointment
 ** find the appointment in prodmirror and verify it was scheduled by ""PORTAL""

h2. RM
 * verify integration tests pass",,,,,,,,,,,,,,0,,,,,05/18/2020 11:58 AM;jmello;One thought - lmk what you think,05/18/2020 3:14 PM;redger;i don't really agree.  but if you feel strongly we can talk more about it,05/20/2020 12:16 PM;jmello;One last thought,05/21/2020 4:24 PM;jmello;one issue with the references in Services/Core,"05/26/2020 9:06 AM;redger;sorry, fixed","05/27/2020 5:37 PM;dstrickland;[~redger], RM and Services PRs have conflicts. I'll go ahead and start testing.","05/27/2020 6:18 PM;dstrickland;[~redger], I couldn't get the services solution to build. Could you take a look, please? Here's the error:
{code:java}
  BookPortalAWOAppointmentThroughMDP.cs(45, 48): [CS1061] 'IMDPClient' does not contain a definition for 'BookRecommendedPortalAppointmentForAWOAsUserAsync' and no accessible extension method 'BookRecommendedPortalAppointmentForAWOAsUserAsync' accepting a first argument of type 'IMDPClient' could be found (are you missing a using directive or an assembly reference?) {code}
I noticed the project was on build 12 of the athenanet repo and tried updating to build 13, but still no dice.

Thanks in advance.","05/28/2020 12:08 PM;redger;note that the PR is still conflicted against Chitra's changes, but she is still working to resolve the services repo updates.  this should be in a state that can be tested","05/28/2020 4:49 PM;dstrickland;[~redger], it's possible I'm doing something wrong here, but I'm getting a 500 when I try to call the adminBooking/bookingFromSlots endpoint. ISE from MDP with no meaningful error message captured. Here's the request body. Could you take a look and see if it's related to your changes?
{code:java}
{
  ""resourceType"": ""Appointment"",
  ""slot"": [
    {
      ""reference"": ""/Slot/13711-61-198.4683314"",
      ""type"": ""Slot""
    }
  ],
  ""serviceType"": [
    {
      ""coding"": [
        {
          ""system"": ""codesystem.scheduling.athena.io/servicetype.athenanet.13711"",
          ""code"": ""2""
        }
      ]
    }
  ],
  ""status"": ""proposed"",
  ""participant"": [{
    ""status"": ""needs-action"",
    ""actor"": {
      ""reference"": ""/Patient/13711-1103818"",
      ""type"": ""Patient""
    }
  }],
  ""comment"": ""test""
}
{code}",05/29/2020 10:01 AM;redger;works fine for me targeting devmain-stage.   i should have mentioned that in the test plan,"05/29/2020 1:33 PM;dstrickland;[~redger], I think I found a bug that's related to your changes here. The /rescheduleToModifiedSlot endpoint did not correctly set the username.

Reproduction steps:
 # Book a slot per the test plan above.
 # Find another open slot.
 # Call /rescheduleToModifiedSlot with the old and new slot. Here are the parameters I used, for reference:
{code:java}
 {
  ""resourceType"": ""Bundle"",
  ""type"": ""collection"",
  ""entry"": [
    {
      ""resource"": {
        ""resourceType"": ""Appointment"",
        ""id"": ""432-2-85.395234"",
        ""status"": ""cancelled"",
        ""cancelationReason"": {
          ""coding"": [
            {
              ""system"": ""appointmentcancelreason.athenanet.432"",
              ""code"": ""85""
            }
          ]
        }
      }
    },
    {      
      ""resource"": {
        ""resourceType"": ""Appointment"",
        ""status"": ""proposed"",
        ""serviceType"": [
          {
            ""coding"": [
              {
                ""system"": ""codesystem.scheduling.athena.io/servicetype.athenanet.432"",
                ""code"": ""7""
              }
            ]
          }
        ],        
        ""comment"": ""Patient called to reschedule"",
        ""participant"": [
          {
            ""actor"": {
              ""reference"": ""/Patient/432-85586"",
              ""type"": ""Patient""
            },
            ""status"": ""tentative""
          }
        ],
        ""contained"": [{
          ""resourceType"": ""Slot"",
          ""id"": ""432-2-85.395235"",
          ""extension"": [{
           ""url"": ""extension.scheduling.athena.io/slot.athenanet/isfrozen"",
            ""valueBoolean"": false
          }],
          ""start"": ""1900-01-01T19:05:00-04:00"",
          ""end"": ""1900-01-01T19:15:02-04:00"",
          ""schedule"": {
            ""reference"": ""/Schedule/432-2-85"",
            ""type"": ""Schedule""
          }
        }]
      }
    }
  ]
}{code}
 # Verify a 200 response from the rescheduleToModifiedSlot endpoint.
 # Check the audit history of the rescheduled appointment in athenaNet. You should get a javascript alert about an error due to a missing USERNAME property.",05/29/2020 1:40 PM;dstrickland;Future testers note that I also had to pull bookable appointments using the sql query in SCORE-1533 to get this working.,"05/29/2020 2:24 PM;dstrickland;The issue above will be addressed in SCORE-1729. Everything else checked out, so I'm marking QADev done.",,,,,,,,,,,,,,,,,,,,
SPIKE - be able to determine which appointments were booked through the practice calendar,SCORE-1576,1236941,Story,Blocked,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,redger,redger,redger,5/5/20 12:53,6/17/20 14:27,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,[~ctaylor] needs to be able to write reports based on which appointments were booked using the new practice calendar.  ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1576</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-257,,,,,,,,,,,,,,,,,,,,1236941,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1576</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|hv0lg0:442,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,,,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,05/21/2020 11:23 AM;redger;spike can be completed once the linked stories are finished.  ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
AC Wellness |Add cancelationreasonID and cancellation date and time as new outputs to GET/patient/patientid/appointments,SCORE-1574,1236786,Story,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,High,Done,,kneuberger,dpark,5/5/20 11:03,6/23/20 17:22,6/24/20 17:27,6/23/20 17:22,MDP API Enhancement,,0,ACWellness,CustomerIssue_Platform,ENGAGE:DRIVE,GOLIVE:N,INITIATIVE:DRIVEINTEROP,INT:API,PIQ,PK_API,PSCOMPLIANCE:N,REGULATORY:?,RISKFACTORSCORE:0,RQST:PRODUCT:FEATURE:REQUEST,TEAM:DESIGN:API,VOC:YES,"We currently show that an appointment has been cancelled via the output of GET/patient/patientid/appointments, however, we do not have an API call that shows the cancelappointmentreason.id or when the cancellation was reported (date/time).  

 

This is an ACW ask to allow them to better report on why patients are cancelling appointments. I believe this would also benefit our other clients well giving them visibility into cancellations. 

 

ASK: 
 1) Add cancelappointmentreasonid in output for GET/patients/patientid/appointments call. 
 2) Add cancellation date and time in output for GET/patients/patientid/appointments call. 

 

This is a post live ACW ask. ",,alahey,dacurtis,dpark,kneuberger,mheang,,,,,,,,,,,,,,,,,,,IOCOL-831,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,,redger,6/22/20 0:00,,,DISABLED,,midavis,6/22/20 0:00,,,,,,,,,,,,,,3981538,,,,,,,,,,redger,6/22/20 0:00,,,,,,,,,,,,,,,,,,dpark,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1574</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1520,,,,,,,,,,,,,,,,,,,,1236786,,,,,aflanagan,6/22/20 0:00,jolopez,6/22/20 0:00,,,,,,,,,6/24/20 0:00,Pre-Approved Patches,6/24/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1574</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/22/20 0:00,rmallen,6/23/20 0:00,2|i0lcpl:p,,GA,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"verify unit tests

 utest --ignorewip --failedonly --color Ecosystem::API::Patient
 $AX_HOME/athenax perl-test Ecosystem::API::Patient



Find a cancelled appointment in the future. 

In the MDP test page go to /patients/{patientid}/appointments

I used patientID 1037806 on PTEST, context 432

showcancelled = Y
and showpast = N

verify you see an appointment that is cancelled with the cancel reason and date filled out


If endpoint also returned a non cancelled appointment then verify it doesn't show the 2 cancel fields otherwise find a noncancelled appointment and verify using that ID.",,,,,,,,,,,,,,0,,,,,05/05/2020 11:44 AM;kneuberger;[~alahey],05/07/2020 2:26 PM;dacurtis;Target completion date of end of July,05/07/2020 2:27 PM;dacurtis;Should target development completion by end of June to make typical ANet release schedule.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Handle UHG eligibility fault codes appropriately,SCORE-1571,1236549,Story,Deployed,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,jpickens,gdawson,gdawson,5/5/20 8:23,6/19/20 9:45,6/24/20 17:27,6/12/20 17:04,,,0,,,,,,,,,,,,,,,"The UHG eligibility API returns HTTP 400 status codes that have additional fault codes within the response body.

For status code 400 responses without a fault code or a fault code below, continue returning a status code 400 from the RM UHGInitiateEligibilityCheck endpoint:
* ED270ED
* ED270IU
* ED27BR - we shouldn't see this fault code

For status code 400 responses with a fault code below, cache an ineligible status for the patient and return 202 Accept:
* ED270AR
* ED270GE
* ED270NP
* ED270IP
* ED270BP - we shouldn't see this fault code
* ED270IA - policy is no longer active
* AAA:*

For status code 400 responses with a fault code below, we should retry but return an appropriate 50x status code (502?):
* ED270SE
* ED270UE
* ED270UR
* ED270GW

",,gdawson,jpickens,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/12/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,redger,6/12/20 0:00,,,,,,,,,,,,,,,,,,jpickens,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1571</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-925,,,,,,,,,,,,,,,,,,,,1236549,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1571</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/12/20 0:00,,,2|i0fofl:i,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"I now have unit tests that cover all the scenerios in the test plan below, so you can simply ensure those unit tests pass ({{UHGAPIClientTests}}). But if you just want to be thorough (and because it took me so long to write that I don't want to delete it), you can still do this somewhat over-complicated test plan.

*The remainder of this test plan is optional.*

First, we'll test a successful workflow to ensure we didn't break anything.
 * Check out this branch and run {{Referral.Functions}} project locally.
 * From your dev server run the following to get an aNet JWT token:
{code:java}
export ATHENA_HOME=/usr/local/athena/prod/; perl -MAthena::Lib -MAthena::Driver::IdentityAccessManagement -e '$Global::session{USERNAME} = ""kknight15""; print ""\ntoken:\n"" . Athena::Driver::IdentityAccessManagement::GetAthenaNetSignedUserJWT(undef, {SCOPES => [""scheduling.token.create""]}) . ""\n"";'
{code}

 * Using Insomnia, hit the {{/api/UHG/InitiateEligibilityCheck}} endpoint, supplying the following parameters:
 ** aNet JWT token: the token from the previous step
 ** Context Id: 593
 ** Patient Id: 25628
 ** Chart ID: 82912
 ** Department ID: 1
 * Verify that you get a {{202 Accepted}} response in Insomnia along with a GUID which is your correlation ID.
 * In Azure Storage Explorer or the Azure Portal, open {{schednonprodcosmosdb}}, navigate to the {{Caching}} database and into the collection named <YOUR_ENV>_General (eg. jpickens_General) and then into Documents.
 * There, you should find a document whose name begins with {{rm-uhg-eligibility-check_}} and ends with the correllation ID you got from Insomnia. Open it.

 * In the document, within the JSON element and you should see something similar to the following:
{code:java}
\""Eligible\"":true
{code}
This means the eligibility check for the given parameters returned a {{true}} response.

Now, we'll test one of the fault codes (ED270IP), which should result in a 202 response back to the client, but an ineligible status.
 * With the {{Referral.Functions}} project still running locally, get a new aNet JWT token from your dev server and hit the same endpoint again.
 ** aNet JWT token: the token from the previous step
 ** Context Id: 4803
 ** Patient Id: 162268
 ** Chart ID: 69887
 ** Department ID: 3
 * You should get a warning in your console similar to the following:
{code:java}
Unsuccessful UHG API call. Endpoint: Bundle/$standard-eligibility; REST Status Code: BadRequest; UHG issue severity: Warning; UHG issue code: ED270IP; UHG issue text: ""This plan is administered by a different payer."". Storing ineligible status for patient id 162268 in context 4803.
{code}

 * In Insomnia, you should still get a {{202 Accepted}} response and a correlation ID.
 * In your <YOUR_ENV>_General collection, you should have a new {{rm-uhg-eligibility-check}}_ document ending with the new correlation ID. Open it.
 * You should now see:
{code:java}
\""Eligible\"":false
{code}
 ...indicating an ineligible status.

The next scenerios are more difficult to test as they involve seemingly transient errors that are not consistently produced for a given set of parameters, so we're going to have to use some debugger magic to make them happen.

First, we'll test a fault code that should return a 500 status code to the client:
 * With the {{Referral.Functions}} project still running locally, set a breakpoint in {{UHGAPIClient}} at line 105 on the following line of code:
{code:java}
if (success = response.IsSuccessful && response.Data.ResourceType == ResourceType.Bundle)
{code}

 * Get a new aNet JWT token and call the endpoint again with the same parameters as before.
 * When you hit the breakpoint, modify the {{response}} object in the debugger. Set {{response.Data.Issue[0].Details.Coding[0].Code}} equal to ""ED270SE"".
 * Continue in the debugger and you should get a warning in your console similar to the following:
{code:java}
Unsuccessful UHG API call. Endpoint: Bundle/$standard-eligibility; REST Status Code: BadRequest; UHG issue severity: Warning; UHG issue code: ED270SE; UHG issue text: ""This plan is administered by a different payer."". Retrying...
{code}

 * You should hit the breakpoint again as it re-tries. Modify the {{response}} object in the same way and also set {{retries}} = 0 and continue.
 * This time, you should get the following error in your console:
{code:java}
Unsuccessful UHG API call. Endpoint: Bundle/$standard-eligibility; REST Status Code: BadRequest; UHG issue severity: Warning; UHG issue code: ED270SE; UHG issue text: ""This plan is administered by a different payer."". Failing...
{code}

 * And you should get a {{503 Service Unavailable}} response in Insomnia.

Now, we'll test a fault code that should result in a 400 error.
 * With the {{Referral.Functions}} project still running locally and the same breakpoint set, get a new aNet JWT token and hit the same endpoint in Insomnia with the same parameters.
 * This time, when you hit the endpoint, change {{response.Data.Issue[0].Details.Coding[0].Code}} in the debugger to ""ED270ED"" and continue.
 * You should get a {{400 Bad Request}} response in Insomnia.

Next, we'll test an unexpected fault code.
 * With the {{Referral.Functions}} project still running locally and the same breakpoint set, get a new aNet JWT token and hit the same endpoint in Insomnia with the same parameters.
 * This time, when you hit the endpoint, change {{response.Data.Issue[0].Details.Coding[0].Code}} in the debugger to ""504"" and continue.
 * You should get a {{400 Bad Request}} response in Insomnia.

Finally, we'll test an empty fault code.
 * With the {{Referral.Functions}} project still running locally and the same breakpoint set, get a new aNet JWT token and hit the same endpoint in Insomnia with the same parameters.
 * This time, when you hit the endpoint, change {{response.Data.Issue[0].Details.Coding[0].Code}} in the debugger to """" (empty string) and continue.
 * You should get a {{400 Bad Request}} response in Insomnia.",,,,,,,,,,,,,,0,,,,,"05/27/2020 8:44 AM;gdawson;App Insights trace:
{code:java}
union traces
| union exceptions
| where timestamp > ago(30d)
| where customDimensions['InvocationId'] == '31cf7154-a089-4250-8bc3-2c33f466fc28'
| order by timestamp asc
| project timestamp, message = iff(message != '', message, iff(innermostMessage != '', innermostMessage, customDimensions.['prop__{OriginalFormat}'])), logLevel = customDimensions.['LogLevel']
{code}
Example 400 response from UHG:

 
{code:java}
{
  ""resourceType"": ""OperationOutcome"",
  ""meta"": {
    ""lastUpdated"": ""2020-05-04T14:46:38.239+00:00""
  },
  ""issue"": [
    {
      ""severity"": ""warning"",
      ""code"": ""unknown"",
      ""details"": {
        ""coding"": [
          {
            ""code"": ""ED270IP""
          }
        ],
        ""text"": ""This plan is administered by a different payer.""
      }
    }
  ]
}
{code}
 ","05/27/2020 3:03 PM;jpickens;Here's a good App Insights query to find these fault codes in the logs:
{code}
traces 
| where timestamp > ago(1d)
| where message startswith ""Unsuccessful UHG API call.""
| join
(
    requests
    | project operation_Id, context_Id = customDimensions.[""Context ID""], patient_Id = customDimensions.[""Patient ID""], req_customDimensions = customDimensions
)
on operation_Id
| project timestamp, operation_Id, context_Id, patient_Id, message, content_json = parse_json(extract(""; Content: ({.*})"", 1, message))
| project timestamp, operation_Id, context_Id, patient_Id, fault_code = content_json.issue[0].details.coding[0].code, fault_text = content_json.issue[0].details.text
| order by timestamp desc
{code}",06/08/2020 12:31 PM;redger;needs unit tests,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
Ability for non-dev (Mike) to see context status in Insomnia,SCORE-1535,1230911,Story,Coding,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,gdawson,midavis,midavis,4/29/20 12:48,6/24/20 9:35,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"AC:
 * List all contexts
 ** Auto-sync status
 ** Timestamp of last auto-sync
 ** Channels
 *** auth
 *** un-auth
 *** referral",,dstrickland,gdawson,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,gdawson,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1535</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,,,,,,,,,,,,,,,,,,,,,1230911,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1535</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|i0lcpl:qr,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,Ecuador Eclair,4,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"Follow these steps as in SCORE-1276:
 * create a new branch from this one
 * re-add this deleted code section: [https://bitbucket.athenahealth.com/projects/SCORE/repos/services/commits/3ee6690b06ff459401f3f683b1cdc64b50ec8eae]
 * dev deploy your new branch:
[https://jenkins.scheduling.nonprod.athena.io/job/SCORE_Dev_Deploy]
 * in the schednonprodcosmosdb edit the \{environment}_anet-auto-sync 
MappingConfiguration document.
Add 432 (or w.e context you are throwing an exception for) into the ContextIds list. Add a good context for good measure like 14417.
 * In the \{environment}-scoreASEfunctions resource go to Configuration.
For the key SnowflakeExtractSchedule change the value to 0 */10 * * * *
 * Go back to the scoreASEFunctions homepage, and scroll down to SyncAthenaNetContextMappings_Orchestrator, click monitor
 * Wait until it runs

Once it has run, the MappingConfig document should have a successful and failed context sync.
 * Run Get Auto Sync Contexts in Insomnia with a System Admin token
 * Verify that the acceptance criteria are met
 * Run Unit Tests",,,,,,,,,,,,,,0,,,,,"05/04/2020 1:50 PM;dstrickland;I picked this up for a minute, but put it back down to work on a telehealth bug. Don't have any meaningful progress to share at this point.",06/15/2020 12:57 PM;redger;no test plan?,06/16/2020 12:40 PM;redger;i don't see how your test plan exercises all of the code changes you've made. particularly surrounding setting the new fields that you've added.,06/16/2020 10:51 PM;gdawson;That's what I get for delaying it for all the other issues. I added the steps I followed from one of the earlier auto-sync test plans.,06/24/2020 9:35 AM;redger;[~gdawson] any update on this?,,,,,,,,,,,,,,,,,,,,,,,,,,,,
CLONE - AC Wellness: Add input parameter to PUT/appointments/appointmentid/reschedule to indicate the cancellation reason as we require in the UI,SCORE-1512,1226328,Story,Patch,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,High,,,kneuberger,midavis,4/27/20 13:13,6/24/20 14:39,6/24/20 17:27,,MDP API Enhancement,,0,ACWellness,CustomerIssue_Platform,GOLIVE:N,INITIATIVE:Network:CUCVendorStandards,INT:ALL_INTEGRATION_TYPES,None,PIQ,RISKFACTOR:NaN,RQST:SERVICE:INTEGRITY,TEAM:DESIGN:API,VOC:YES,,,,"In the UI when a user goes to reschedule an appointment we require that the user selects an Reason for cancellation. These options in the drop down (screenshot attached) are from the Appointment Cancellation Reasons table in the GEAR-->SCHEDULE-_>Appointment Cancellation Reasons. 

 

PUT/appointments/appointmentid/reschedule API does NOT mimic the UI experience for rescheduling an appointment. We currently allow a user to add a reschedule reason note, but this gets added as appointment note vs. tracked as a true cancellation reason in athenaNet. 

 

ASK: Update PUT/appointments/appointmentid/reschedule API to mimic the UI experience. Add input parameter for appointmentcancelreasonid which should coorospond to the appointment cancellation reasons table. 

**",,dacurtis,kneuberger,mheang,midavis,,,,,,,,,,,,,,,,,,,,IOCOL-1082,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,redger,6/23/20 0:00,,,DISABLED,,midavis,6/23/20 0:00,,,,,,,,,,,,,,3984515,3984516,3984517,,,,,,,,redger,6/23/20 0:00,,,,,,,,,,,,,,,,,,dpark,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1512</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1520,,,,,,,,,,,,,,,,,,,,1226328,,,,,aflanagan,6/23/20 0:00,jolopez,6/24/20 0:00,,,,,,,,,6/25/20 0:00,Pre-Approved Patches,6/25/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1512</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/23/20 0:00,rmallen,6/24/20 0:00,2|i0lcpl:qi,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"I used context 13711 on PTEST

Find an appointmentcancelreason, I used 7
{code:java}
select * from appointmentcancelreason;{code}
Find a booked appointment, note the ID and the PATIENTID and DEPARTMENTID
{code:java}
select * from appointment where status = 'f' and rownum < 5 and appointmentdate > trunc(sysdate + 3) and appointmenttypeid = 466 and CREATEDBY <> 'PORTAL';{code}
Find an open appointment, note the ID
{code:java}
select * from appointment where status = 'o' and rownum < 5 and appointmentdate >  trunc(sysdate + 5) and appointmenttypeid = 466 and departmentid = ?;{code}
In the MDP test page (gear -> root -> MDP API Test)
{code:java}
go to PUT /appointments/{appointmentid}/reschedule{code}
use the 4 fields found from the queries above, verify an appointment is returned back to you

verify the cancel reason with
{code:java}
 select APPOINTMENTCANCELREASONID from appointment where ID = ?{code}",,,,,,,,,,,,,,0,,,,,"05/07/2020 2:31 PM;dacurtis;Target deployment in July, so target dev complete in June.",05/07/2020 2:33 PM;dacurtis;[~midavis] - Looking into list of available cancellation reasons.,05/07/2020 2:45 PM;kneuberger;[~dacurtis] FYI we do have an API already exposing the cancellation reasons table  GET /appointmentcancelreasons :) ,05/07/2020 3:55 PM;dacurtis;Thanks Katie!,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
SPIKE: [19661] Abnormal behavior for PUT /appointments/{appointmentid}/cancel ,SCORE-1470,1222480,Bug,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,Medium,Done,,kneuberger,kneuberger,4/22/20 14:12,6/9/20 17:39,6/24/20 17:27,6/9/20 17:39,,,0,ACWellness,CustomerIssue_Platform,ProductKnowledge,,,,,,,,,,,,"[Client Facing]
 *Context:* [19661]

*Bug Description:*
 AC Wellness has reported that they are seeing abnormal with API endpoint PUT /appointments/\{appointmentid}/cancel. 
 They have reported that at times the endpoint surfaces the following error: 
 
 Here are a few of the transactions (all times in PST): 
 2020-04-16 17:57:52 
 \{""message"":""Athena API Error. uri: /preview1/19661/appointments/1604348/cancel, method: PUT, status: 404, response_body: \n\n{\""error\"":\""It is too late to cancel this appointment.\""}
 2020-04-16 17:57:27 
 \{""message"":""Athena API Error. uri: /preview1/19661/appointments/1604329/cancel, method: PUT, status: 404, response_body: \n\n{\""error\"":\""It is too late to cancel this appointment.\""}
 2020-04-16 17:47:31 
 \{""message"":""Athena API Error. uri: /preview1/19661/appointments/1604331/cancel, method: PUT, status: 404, response_body: \n\n{\""error\"":\""It is too late to cancel this appointment.\""}

 However, if they wait shortly after they are able to make the call. Please see 1 example where it seems nothing has changed between the two reqests to us, but we are handling them differently allowing a cancellation. 
 
 *Replication Steps:*
 I am comparing two now and cant see any difference why 1 failed and the other went through. 
 
 [04/16/2020 20:00:08 webpreview103.athenahealth.com /usr/local/athena/prod/htdocs/hidden_exposed.esp 113780] PUT,/v1/19661/appointments/1604292/cancel,TOOLATETOCANCEL,API-11473,
 
ARGS=\{""ORIGINALURI"":""\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""FAKEHEADERS"":{""HOST"":""preview.athenahealth.com"",""X-Mashery-Message-ID"":""97a0b699-8e8d-4c1f-b659-28da551a14a1"",""X-ORIGINAL-USER-AGENT"":""Vert.x-WebClient\/3.8.4"",""X-dynatrace-Origin-URL"":""http:\/\/preview.athenahealth.com\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""Content-Type"":""application\/x-www-form-urlencoded"",""X-Mashery-Oauth-Scope"":"""",""X-MASHERY-OAUTH-ACCESS-TOKEN"":""MD5DIGEST_26e28996a84fa45900b7920c9c726eb5"",""X-MASHERY-OAUTH-SCOPE"":"""",""X-Original-User-Agent"":""Vert.x-WebClient\/3.8.4"",""X-Mashery-Oauth-Access-Token"":""MD5DIGEST_26e28996a84fa45900b7920c9c726eb5"",""X-MASHERY-OAUTH-CLIENT-ID"":""5jrakngmv9kgsc89vrkq5c6f"",""Accept-Encoding"":""deflate, gzip"",""AUTHORIZATION"":""MD5DIGEST_84a8f13bf198549d10ed428cbabb361c"",""X-dynaTrace-Application"":""1;1;RUM Default Application"",""X-DTINIT"":""true"",""Host"":""preview.athenahealth.com"",""X-DYNATRACE-APPLICATION"":""1;1;RUM Default Application"",""X-MASHERY-OAUTH-USER-CONTEXT"":"""",""X-FORWARDED-FOR"":""54.82.131.67"",""X-RUXIT-APACHE-SERVERNAMEPORTS"":""athenanet.athenahealth.com"",""X-Forwarded-For"":""54.82.131.67"",""Connection"":""keep-alive"",""X-Mashery-Oauth-User-Context"":"""",""Content-Length"":""44"",""X-MASHERY-MESSAGE-ID"":""97a0b699-8e8d-4c1f-b659-28da551a14a1"",""CONTENT-TYPE"":""application\/x-www-form-urlencoded"",""USER-AGENT"":""Mashery Proxy"",""ACCEPT-ENCODING"":""deflate, gzip"",""X-ruxit-Apache-ServerNamePorts"":""athenanet.athenahealth.com"",""Authorization"":""MD5DIGEST_84a8f13bf198549d10ed428cbabb361c"",""x-dtinit"":""true"",""User-Agent"":""Mashery Proxy"",""CONNECTION"":""keep-alive"",""COOKIE"":""dtCookie=72E6F12EFD52D98F5B5C91073BD50368|RUM Default Application|1"",""X-DYNATRACE-ORIGIN-URL"":""http:\/\/preview.athenahealth.com\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""Cookie"":""dtCookie=72E6F12EFD52D98F5B5C91073BD50368|RUM Default Application|1"",""CONTENT-LENGTH"":""44"",""X-Mashery-Oauth-Client-Id"":""5jrakngmv9kgsc89vrkq5c6f""},""REMOTEIPADDRESS"":""54.82.131.67"",""FDAT"":\{""PATIENTID"":""54574"",""APPOINTMENTCANCELREASONID"":""22""},""APACHEREQUESTINFO"":\{""URI"":""\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""HOST"":""preview.athenahealth.com"",""METHOD"":""PUT"",""PORT"":null}}&REFERRER=\{""ROUTE"":""MDP1:\/appointments\/{appointmentid}\/cancel""}&SUB=Ecosystem::API::Utils::Infrastructure::ProcessProxiedRequest&UTF8=1


 Then same call was made a little later: No error in bad call logs: 
 April 16th 2020, 20:16:19.000 T-04:00 MDPP1::PUT:/appointments/\{appointmentid}/cancel API-11473
|April 16th 2020, 20:16:19.000 T-04:00|MDPP1::PUT:/appointments/\{appointmentid}/cancel|API-11473|


 ARGS=\{""ORIGINALURI"":""\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""FAKEHEADERS"":{""HOST"":""preview.athenahealth.com"",""X-Mashery-Message-ID"":""2fdc9a59-fc17-4d28-8332-e8faa9860fd8"",""X-ORIGINAL-USER-AGENT"":""Vert.x-WebClient\/3.8.4"",""X-dynatrace-Origin-URL"":""http:\/\/preview.athenahealth.com\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""Content-Type"":""application\/x-www-form-urlencoded"",""X-Mashery-Oauth-Scope"":"""",""X-MASHERY-OAUTH-ACCESS-TOKEN"":""MD5DIGEST_276d49ec9ebc56d999a802345ff8b1d3"",""X-MASHERY-OAUTH-SCOPE"":"""",""X-Original-User-Agent"":""Vert.x-WebClient\/3.8.4"",""X-Mashery-Oauth-Access-Token"":""MD5DIGEST_276d49ec9ebc56d999a802345ff8b1d3"",""X-MASHERY-OAUTH-CLIENT-ID"":""5jrakngmv9kgsc89vrkq5c6f"",""Accept-Encoding"":""deflate, gzip"",""AUTHORIZATION"":""MD5DIGEST_3d093c5ec35910249848d70a5db2e266"",""X-dynaTrace-Application"":""1;1;RUM Default Application"",""X-DTINIT"":""true"",""Host"":""preview.athenahealth.com"",""X-DYNATRACE-APPLICATION"":""1;1;RUM Default Application"",""X-MASHERY-OAUTH-USER-CONTEXT"":"""",""X-FORWARDED-FOR"":""54.82.131.49"",""X-RUXIT-APACHE-SERVERNAMEPORTS"":""athenanet.athenahealth.com"",""X-Forwarded-For"":""54.82.131.49"",""Connection"":""keep-alive"",""X-Mashery-Oauth-User-Context"":"""",""Content-Length"":""44"",""X-MASHERY-MESSAGE-ID"":""2fdc9a59-fc17-4d28-8332-e8faa9860fd8"",""CONTENT-TYPE"":""application\/x-www-form-urlencoded"",""USER-AGENT"":""Mashery Proxy"",""ACCEPT-ENCODING"":""deflate, gzip"",""X-ruxit-Apache-ServerNamePorts"":""athenanet.athenahealth.com"",""Authorization"":""MD5DIGEST_3d093c5ec35910249848d70a5db2e266"",""x-dtinit"":""true"",""User-Agent"":""Mashery Proxy"",""CONNECTION"":""keep-alive"",""COOKIE"":""dtCookie=7142784EB9D9A6FF0FB2FF9B7CFABDDB|RUM Default Application|1"",""X-DYNATRACE-ORIGIN-URL"":""http:\/\/preview.athenahealth.com\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""Cookie"":""dtCookie=7142784EB9D9A6FF0FB2FF9B7CFABDDB|RUM Default Application|1"",""CONTENT-LENGTH"":""44"",""X-Mashery-Oauth-Client-Id"":""5jrakngmv9kgsc89vrkq5c6f""},""REMOTEIPADDRESS"":""54.82.131.49"",""FDAT"":\{""PATIENTID"":""54574"",""APPOINTMENTCANCELREASONID"":""22""},""APACHEREQUESTINFO"":\{""URI"":""\/htservices_external\/ecosystem\/api\/proxy.esp\/v1\/19661\/appointments\/1604292\/cancel"",""HOST"":""preview.athenahealth.com"",""METHOD"":""PUT"",""PORT"":null}}&REFERRER=\{""ROUTE"":""MDP1:\/appointments\/{appointmentid}\/cancel""}&SUB=Ecosystem::API::Utils::Infrastructure::ProcessProxiedRequest&UTF8=1

 ",,alahey,dpark,jmello,kneuberger,mheang,midavis,,,,,,,,,,,,,,,,,,,,,,,,,,,05/12/2020 3:27 PM;alahey;image-2020-05-12-16-27-37-181.png;https://athenajira.athenahealth.com/secure/attachment/552280/image-2020-05-12-16-27-37-181.png,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,redger,6/9/20 0:00,,,DISABLED,,midavis,6/9/20 0:00,,,,,,,,,,,,,,3960433,3962719,3962720,3963979,3963980,3965475,,,,,jmello,6/8/20 0:00,,,,,,,,,,,,,,,,,,dpark,,,,,,,,,,,,P4 Production,,,,,,,,,,,,,1222480,,,,,aflanagan,6/9/20 0:00,,,,,,,,,,,6/10/20 0:00,Pre-Approved Patches,6/10/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1470</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jmello,6/8/20 0:00,jmello,6/9/20 0:00,2|hv0lye:14,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,2,,,,,Cape Cod Creme Brulee,Danish Denmark,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"Ensure unit tests pass

 utest --ignorewip --failedonly --color Appointment::FillAppointment
 $AX_HOME/athenax perl-test Appointment",,,,,,,,,,,,,,0,,,,,"04/22/2020 2:12 PM;kneuberger;Task created via '[bug triage|https://devnet.athenahealth.com/bug_triage]'

Originally sent to 'Scheduling: Core Architecture'.

","05/12/2020 12:29 PM;kneuberger;[~krwood] Any update on this bug item from the collector PK side of the house? AC Wellness has asked for an update if possible

 ","05/12/2020 2:51 PM;kneuberger;Client stated that they have a 0 hour time set for cancellations of appointments in the UI. Hypothetically they shouldnt receive an error for any cancellations then? Are we tapping into a default for the API instead of the true setting when checking if a cancel can go through? 

 

Reporting this in PROD as well as preview ",05/12/2020 2:53 PM;kneuberger;[~alahey] FYI Jira for the item discussed,"05/12/2020 3:28 PM;alahey;!image-2020-05-12-16-27-37-181.png!

Please see screenshot of the setting that the client has configured to always allow patients to cancel no matter how close it is to the appointment time. Is this the same field that the API references? ",05/18/2020 12:29 PM;kneuberger;[~midavis] is your team able to take a look at this bug? ACW reported this about a month ago and is asking for updates? Any insight here?,"05/18/2020 12:42 PM;midavis;We haven't had much time to review legacy bugs lately, but i'll make sure its discussed at our next sync...which happens to be today.

FYI [~dacurtis]","05/18/2020 1:08 PM;midavis;[~keknight] - do you know if 0 is a suggested value for when customers allow last minute cancellations or do we suggest they leave it blank?

 

 ","05/20/2020 7:50 PM;kneuberger;[~midavis] Any update post meeting Monday on this item?  

 

Thanks! ","05/28/2020 4:22 AM;dpark;Hi [~kneuberger] it looks like the appointmenttype setting for that type wasn't created until 04/16/2020 20:15:29, until then the default cancellation is set to 24hrs. The failed requests all occured prior to 4/16/20 20:15:29
","05/28/2020 7:56 AM;kneuberger;[~dpark] thank you for this insight. which environment are you referring to for the above comment? Preview or Production? 

 

There are two issues going on here or rather need to be investigated: 

1) Why in production are cancellation errors showing up when set to 0hrs (i think your comment above covers that, but looking for confirmation ) 

2) In preview- they are getting a cancellation error and then if they wait a few minutes and try to cancel the same appointment- they are able to cancel. Why is this?

 

CC: [~alahey] [~mheang]","05/28/2020 9:49 AM;dpark;In preview, they made failed calls at 17:00:00, then they created appt type settings at 20:00:00 which then the calls became successful because the default is 24 until it was set to 0.","05/28/2020 10:00 AM;kneuberger;Hi [~dpark] ok thank you that is helpful. Do we need more information such as PROD examples of cancellations to dig into the questions that have come up with that environment vs. preview? 

 

I will report back the findings on preview",05/28/2020 10:30 AM;dpark;I'm not seeing the examples made into prod? I think all the ones in the desc. are from preview ?,"05/28/2020 12:06 PM;kneuberger;[~dpark] I reported the setting piece to the client, but they stated the following: 

""This has occurred as recently as last week when I was doing some testing.

The settings were completed before the errors occurred.  It’s a single ’save’ button on the Appointment Settings screen so maybe the timestamp gets updated for all appointment types whenever a change is made.  Also, this wouldn’t explain why after waiting an hour or two, I was able to subsequently cancel those appointments or why the bug impacted the same appointment type only on some occasions (the same appt type for the same patient when scheduled twice; one of those appts could be canceled while one couldn’t).""

 

I have requested new examples from both PREVIEW and PROD. I will provide once I have them, but seems like the setting is not definitively the cause here ","05/28/2020 2:37 PM;kneuberger;[~dpark] recent examples of the 404 happening in PREV: 

5/7: 

May 7th 2020, 11:38:43.
request URL: [https://preview.athenahealth.com:8080/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1651677/cancel?]
status: 404 

May 7th 2020, 11:47:55.000 

request URL: [https://preview.athenahealth.com:8080/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1637225/cancel?]
status 200

May 7th 2020, 11:49:46.000 
request URL: [https://preview.athenahealth.com:8080/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1651737/cancel?]
status: 200 

May 7th 2020, 11:34:41.000 T-04:00
Request URL: 
|https://preview.athenahealth.com:8080/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1651677/cancel?|

status: 404

May 7th 2020, 11:33:48.000

[https://preview.athenahealth.com:8080/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1651677/cancel?]

status: 404 

May 7th 2020, 11:33:33.000

[https://preview.athenahealth.com:8080/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1651677/cancel?]

status: 404 

 ","05/29/2020 10:01 AM;dpark;Do you know what environment that preview is pointed at? I am unable to find logs for these in our PREVW logs

Also do you have a recent example of it happening fail then success? The last comment you provided examples of either only success or only failure

appt id: 1651677 only had 404
apptid: 1637225,1651737 only had 200","05/29/2020 10:11 AM;dpark;I jsut went back and re-read what the client said about it not being the settings.

The setting was CREATED at 20:00:00 so it wasn't an updated field because of a shared save button, I have not been able to repro this and there are no examples still outside of the case:

1. tried to cancel -> 404 @ 20:00:08
2.  setting got CREATED @  20:15:29,
3. tried to cancel again -> 200 @ 20:16:19.000","05/29/2020 10:15 AM;dpark;I checked the details of the 404 you sent, for appt id: 1651677 

They tried to cancel at 5/7/20 11:33:33 but the appointment is set to 5/7/20 9:30:00 so it makes sense the cancel wouldn't have gone through.","05/29/2020 11:03 AM;kneuberger;[~dpark] They sent me another example of the inability to cancel and then able to cancel from 4/20. I see it in our kibana logs with this query: [https://kibana.athenahealth.com/app/kibana?#/discover?_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:'2020-04-20T04:00:00.000Z',mode:absolute,to:'2020-04-22T03:59:59.999Z'))&_a=(columns:!(route,status,request.path.full),index:%5Bcommon-apache-%5DYYYY.MM.DD,interval:auto,query:(query_string:(analyze_wildcard:!t,lowercase_expanded_terms:!f,query:'user:APIKEY-5jrakngmv9kgsc89vrkq5c6f%20%26%26%20route:%22MDP1:%2Fappointments%2F%7Bappointmentid%7D%2Fcancel%22')),sort:!('@timestamp',desc))]


|April 20th 2020, 19:49:56.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1607508/cancel?|

|April 20th 2020, 19:50:20.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1607508/cancel?|

|April 20th 2020, 19:50:22.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1607508/cancel?|

|April 20th 2020, 19:50:42.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1607508/cancel?|

|April 20th 2020, 19:51:55.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1607508/cancel?|

|{color:#de350b}April 20th 2020, 22:30:37.000 T-04:00{color}|{color:#de350b}MDP1:/appointments/\{appointmentid}/cancel{color}|{color:#de350b}200{color}|{color:#de350b}/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1607508/cancel?{color}|

 

 

I am going through our logs day by day to find other examples if i can. will add them as i find","05/29/2020 11:17 AM;kneuberger;Another example: 
|May 7th 2020, 11:45:14.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1542431/cancel?|

|May 7th 2020, 11:55:46.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1542431/cancel?|

|{color:#de350b}May 7th 2020, 12:26:06.000 T-04:00{color}|{color:#de350b}MDP1:/appointments/\{appointmentid}/cancel{color}|{color:#de350b}200{color}|{color:#de350b}/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1542431/cancel?{color}|","05/29/2020 12:53 PM;kneuberger;example for this AM: 


|{color:#de350b}May 29th 2020, 13:19:13.000 T-04:00{color}|{color:#de350b}MDP1:/appointments/\{appointmentid}/cancel{color}|{color:#de350b}200{color}|{color:#de350b}/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1436380/cancel?{color}|

|May 29th 2020, 12:59:05.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1436380/cancel?|

|May 29th 2020, 12:58:22.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1436380/cancel?|

|May 29th 2020, 12:56:54.000 T-04:00|MDP1:/appointments/\{appointmentid}/cancel|404|/htservices_external/ecosystem/api/proxy.esp/v1/19661/appointments/1436380/cancel?|

 

 ","06/01/2020 9:36 AM;dpark;For appt id: 1607508 The scheduling rules weren't created until 04/20/2020 20:15:08, so the default was set to 24hrs so it failed.
same for appt id: 1542431, but with a creation at 05/07/2020 12:15:07
same for appt id: 1436380, but with creation time 05/29/2020 13:15:45

Do you know if the scheduling rules (that determine minimum hours to cancel) is something that gets automatically created or needs to be manually created? I'm having trouble finding an appointment id where it didn't fail because the minhours wasn't set yet.

","06/01/2020 11:00 AM;kneuberger;[~dpark] i sent you a teams message on this, but are you able to see who made those changes to the scheduling rules? There is no audit in the table in the UI, but that would be helpful to say back to the client. 

These rules to my knowledge are set manually, but I am wondering if there are any downstream  things that are hitting this? Do any other tables tie into this that if an update is made there it automatically updates something in this area?","06/01/2020 4:05 PM;kneuberger;FYI [~mheang] Dave/I were chatting via teams it seems to be due to this: from what has been seen these instances are the first time that the appointment/dept/provider combo has ever been booked which triggers this job to run, but it only runs every 30 minutes and the 404s are within the 30 minutes before the job runs/ran

 

 investigating what can be done to fix/change this. will connect with you on messaging for client once Dave/i finish up chatting!

 ","06/04/2020 12:23 PM;rmallen;Changelist(s) 3960432 submerged by the 06/05/2020 build of ATHENANET , and were moved to RELENG-5883 to be punted.

This means that your diffs in the noted changelist(s) were removed from those affected files by the build merge. To patch those changes, you must reapply the diffs to the affected files (you can use the apply_changelists script) and submit new revisions of them. Please do not move the original changelists (noted above) back to this Jira issue, only attach the new changelists generated by re-applying and re-submitting your code diffs.  Contact Release Engineering (#release-engineering on Slack) if you have any questions.
","06/05/2020 10:00 AM;jmello;A couple small things, plus some comments on the tests that weren't addressed/responded to","06/05/2020 2:04 PM;dpark;fix stuff that was commented, added new tests for the asked coverage.","06/09/2020 11:31 AM;redger;nightly deployment, please",,,,
Fetch context list/name for config tool,SCORE-1352,1194404,Story,Deploying,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,Done,,dpark,dpark,3/31/20 10:10,6/24/20 11:02,6/24/20 15:38,6/22/20 12:19,,,0,,,,,,,,,,,,,,,"Currently the front end uses a hardcoded JSON for a list of contexts/names

Can we get the information from somewhere else and then create an endpoint for them to use?

Assuming that there is a bus call for this and only want contexts with clinicals enabled.

In this task we should also fix the /api/v2/token/athenanet/contentadmin endpoint, which currently sets the athenanet username to be the email address from the token instead of the value from the ""anetUser"" claim.",,dpark,jmello,mhankin,midavis,sleal,,,,,,,,,,,,,,,,,,,,SFE-188,,,,,,,,05/27/2020 2:43 PM;sleal;2020-05-27_14-41-30.mp4;https://athenajira.athenahealth.com/secure/attachment/560960/2020-05-27_14-41-30.mp4,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,N/A,,,,,DISABLED,,midavis,6/19/20 0:00,,,,,,,,,,,,,,,,,,,,,,,,fmicle,6/19/20 0:00,,,,,,,,,,,,,,,,,,redger,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-1352</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-1238,,,,,,,,,,,,,,,,,,,,1194404,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-1352</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,fmicle,6/18/20 0:00,,,2|i0lcpl:qzi,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Cape Cod Creme Brulee,Danish Denmark,Ecuador Eclair,3,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* find the new insomnia endpoint (Tokens -> Content Admin - Search Contexts)
 * click the ""OAuth 2"" tab
 * click ""Send"" once, you will be prompted for the ""PSX Okta Client Secret""
 ** find the secret here: [https://pwmanager.corp.athenahealth.com/SecretServer/app/#/secret/16270/general]
 ** use the ""dev"" password
 * the request will fail, because you aren't logged in.
 * click ""Fetch Token"" in the Oauth 2 tab
 * log in to Okta in the popup window using your regular corp account
 * now that you are logged in, click ""Send"" again
 ** the previous value of the psx secret will still be there, just click Submit again
 ** it will now ask you for a search term, enter either:
 *** a context id (e.g. 432)  - you will get the exact match for that context
 *** a string - you will get any contexts 
 * try searching for both existent and nonexistent contexts and verify that you get appropriate results",,,,,,,,,,,,,,0,,,,,04/01/2020 10:25 AM;redger;[~dpark] where is this list off contexts used?  what UI is this driving?,"04/01/2020 12:58 PM;mhankin;[~redger] if you're still wondering, this is for the Config Tool UI. It'll be used to populate the search bar on the landing page; as it says in the description, that data is currently hardcoded in a JSON file.",04/02/2020 2:34 PM;midavis;Can this be handled manually by your team [~sleal] ?,04/02/2020 2:57 PM;sleal;[~midavis] - are you wanting my team to make the update in SCORE?,"04/02/2020 3:04 PM;midavis;No...this is a static list that the front end has.  There was a request to make it dynamic and have SCORE provide a list of contexts that is always current.  But i don't think anyone is using this tool and if there is a context(s) missing, your team could add it to the exisitng static list.  ","04/03/2020 4:17 PM;redger;i think eventually the front-end would like to just have an endpoint that they can call that will give them all of the contexts in athenaNet.  (or maybe _search_ all of the contexts in athenaNet).  end-state is that the config tool is used for all contexts and they don't want to have to maintain a list of contexts, because ew.

right now, however, we don't have any notion of ""this context is turned on for the config ui"", so it seems wrong to provide the functionality above.  we will need this eventually, but i think we need to first have a good answer for ""which contexts are supposed to be able to use the config ui?""

 ","04/20/2020 12:37 PM;dpark;Comment from Kera
""The team uses this (config-tool) to tell when a client has been moved to auto-sync. """,04/20/2020 12:53 PM;midavis;is it worth making an endpoint for this [~sleal] - or can the front end team just manually update the list when we stumble upon a net new context?,04/20/2020 1:37 PM;sleal;[~midavis] - is there another way for Kera's team to know which clients have been moved to auto-sync without the config tool?,"04/20/2020 1:42 PM;midavis;yes, they maintain a master list in excel

 

 ",04/20/2020 2:52 PM;sleal;They currently do that: [https://athenahealth.sharepoint.com/:x:/s/ConsumerSchedulingProject/EUoAAvX-o8NJv4rL9Nz1VVIB2AdQgRibNSbKmNTxH3g7eQ?e=tycCgT] ,"05/26/2020 10:23 AM;mhankin;I wanted to bring this one up again. Is there any way that SCORE could expose a list of all contexts in aNet, not just those with auto-sync turned on? Is there somewhere else we should be getting that data? The hardcoded JSON file isn't scaling well.

cc [~jmello]",05/26/2020 2:51 PM;jmello;[~mhankin] we've added this story to our sprint to provide an endpoint you can call,"05/27/2020 2:32 PM;redger;[~sleal] [~mhankin] i haven't seen how the UI for this works - does the user have a search box similar to what is shown when you log in to athenanet?  i.e. you can search by name or ID?

there isn't currently an endpoint in athenanet that we can call to just expose the entire list of contexts, but there is an endpoint that we can use to search by name or ID.   

we _can_ write the endpoint to expose the entire list, but if all you need is to expose search functionality then using the existing endpoint will be easier for us.",05/27/2020 2:43 PM;sleal;[~redger] - the user can search by contextID or the practice name.  I've attached a video for reference.  Being able to search by name or ID is exactly what we need.,"05/27/2020 2:48 PM;redger;thanks Shannah. 

 

dev:  we can use BusCall::PracticeStructure::Find to support this.","06/02/2020 12:04 PM;redger;[~sleal] after doing some more discovery around this I have some more thoughts/questions.

The search for a context should be bound by the contexts that the user is able to log into.   This means that we should not simply return all contexts in athenanet and let the front-end filter based on the input.  

We have a couple of options for doing this:

*1.) Use the existing context search functionality in athenaNet based on the logged-in user*

The existing functionality allows for _either_ an exact match of context id (e.g. you entered 432, so you must have meant context id 432) or a fuzzy match of context name (e.g. you entered Aardvark, so here's a list of contexts that have ""Aardvark"" in the name).  We could use this functionality if:
 # we assumed that any numerical input from the user was meant to be a context id search (this is how the athenanet login screen works today)
 # the front end had a select box for what the user was searching for (context or name)

*2.) SCORE can create a new endpoint in MDP that returns ALL contexts that the user has access to*

We could return all contexts the user has access to, and let the frontend do the filtering for the search term.  This incurs more work on us to write and maintain that endpoint, and - in the case of nonprod athenanet - will return a pretty large bundle, because users in nonprod have access to all ~22,000 contexts.  In addition to the large payload, the front-end may be sluggish to search through all 22,000 contexts and filter them, although i don't have any proof of that.

 

which of those two approaches would you like to proceed with?","06/02/2020 1:31 PM;midavis;I believe we tried this approach late last year where we checked the logged in users level of access but that proved to be impractical for ops personal.

If a user can get into the super-user-config they should have full access to all the contexts.

 

Between the aNet login and the white-list there should be adequate levels of control in place already.

 

Let me know if you concur [~sleal]",06/03/2020 9:22 AM;sleal;[~midavis] - yes agreed.  ,"06/05/2020 4:53 PM;redger;[~midavis] [~sleal] are you saying that a member of the ops team should be able to use the superuser config tool _even if they don't have access to the context_?  that doesn't seem right at all.  

how is it impractical to verify that the logged in okta user has access to the context in athenanet?","06/05/2020 5:39 PM;midavis;Didn't we try this late last year and prove it didn't work?  People on Kera's team couldn't get to the contexts they needed. 

Maybe there was a different bug that we fixed that got caught up in this thread, but we talked about god mode quite a bit last year and I thought we disabled that check for a reason.  [~redger]","06/08/2020 9:18 AM;redger;[~midavis] i thought that was in response to us checking ""what schedules does the user have access to?"" (SCORE-775, SCORE-777).  this task is about what contexts the user can log in to.  seems like you shouldn't be able to log in to the super user config tool unless you can at the very least log in to the context in athenanet?","06/08/2020 9:32 AM;midavis;[~redger] i'm down with trying the context check, is it something we have in place already and just need to turn back on or a new feature we have to create?

 

 ","06/08/2020 10:16 AM;redger;[~midavis] no, it doesn't exist yet, but neither does any endpoint that would allow us to grab all all contexts from athenanet, regardless of user access.   before we move ahead with this, do you want to confirm that Kera & friends are able to log in to all of the contexts that they will be managing through the super user config tool?","06/09/2020 9:38 AM;midavis;[~redger] - Neither Kera nor I have had any login issues with the super-user-config...however we don't manage mappings there anymore so we haven't done much editing other than some fast changes to video appointments when COVID started.

Is the proposal for this grab all contexts endpoint that we check the logged in users access and only return those contexts they have access to?  Example if there are 10,000 contexts in aNet and my account has prod access to 8,000 of them, we would only return those 8,000?

 

 ","06/09/2020 9:49 AM;redger;[~midavis] yes, that's what i proposed","06/09/2020 10:01 AM;midavis;OK, lets proceed with that.  [~redger]","06/12/2020 11:50 AM;redger;i started working on this, but i'm fixing up a few things on the permission stories.  someone else is free to pick this up if they need work",06/12/2020 12:07 PM;mhankin;[~redger] do you think it'd make sense to move this to the Capulets backlog?,"06/12/2020 12:10 PM;redger;if Capulets is the team doing the config UI, then yes, that makes sense. there's not any clear delineation between what score owns and what the stream aligned teams own, so either is probably fine.  ","06/12/2020 12:27 PM;midavis;Lets leave it in our court then, we'll probably get it done faster.

 

 ",06/19/2020 10:39 AM;redger;handled missing or invalid anetUser claim.  i'll fix the merge conflict on the services repo after the anet repo merges,"06/24/2020 11:02 AM;midavis;[~sleal] - FYI this story is done, someone on your team should be able to make the SUC context list dynamic now.

 

 "
PUT /appointments/booked/{appointmentid} is not updating the duration of the appointment,SCORE-956,1133660,Bug,Patched,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,Medium,Done,,howatkins,howatkins,1/27/20 10:26,6/24/20 7:44,6/24/20 17:27,6/23/20 17:22,MDP API Bug,,0,,,,,,,,,,,,,,,"This was first reported on our Developer Portal: [https://developer.athenahealth.com/forum/read/258135]

 

Please see my attached replication steps. 

 

Is this intended functionality?

If so, would you please explain why the appointment duration should stay the same? I’d think that if an appointment type is changing for an appointment, that it would obey the duration of that new appointment type. It would also be a plus if you could update the documentation for the endpoint to better explain why this functionality is the way that it is: [https://developer.athenahealth.com/docs/read/appointments/Update_Booked_Appointments]

If not, would you please fix this bug to reflect the new duration of the appointment?  ",,dpark,howatkins,midavis,tbernosky,,,,,,,,,,,,,,,,,,,,,,,,,,,,,01/27/2020 10:26 AM;howatkins;Replicaiton Steps.docx;https://athenajira.athenahealth.com/secure/attachment/484557/Replicaiton+Steps.docx,06/19/2020 10:20 AM;dpark;screenshot-1.png;https://athenajira.athenahealth.com/secure/attachment/577068/screenshot-1.png,,,,,,,,"Acceptance criteria is dependent on if this is intended functionality or not. 

 

If yes, please explain why the appointment duration should stay the same and update the documentation for the endpoint to better explain why this functionality is the way that it is: [https://developer.athenahealth.com/docs/read/appointments/Update_Booked_Appointments]

 

If not, the duration of the appointment should be updated to reflect the duration of the new appointment type.  ",,,,,,,,,redger,6/22/20 0:00,,,DISABLED,,midavis,6/22/20 0:00,,,,,,,,,,,,,,3980718,,,,,,,,,,redger,6/22/20 0:00,,,,,,,,,,,,,,,,,,dpark,,,,,IOCOL-1034,,,,,,,P4 Production,,,,,,,,,,,,,1133660,,,,,aflanagan,6/22/20 0:00,jolopez,6/23/20 0:00,,,,,,,,,6/24/20 0:00,Pre-Approved Patches,6/24/20 0:00,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-956</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,redger,6/22/20 0:00,rmallen,6/23/20 0:00,2|i0lcpl:q,,GA,,,,,,,,,,,None,None,<Text here>,,,,,,,,,,,,3,,,,,Danish Denmark,Ecuador Eclair,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"verify unit tests
 utest --ignorewip --failedonly --color Ecosystem::API::Utils::Dispatch::AppointmentsGroup
 $AX_HOME/athenax perl-test Ecosystem::API::Utils::Dispatch::AppointmentsGroup
",,,,,,,,,,,,,,0,,,,,"03/05/2020 11:48 AM;midavis;This is the question posted in the forum: 

Hi,

Tried using the API with: {{api.PUT('/appointments/booked') }}and change the appointment type to a different appointment type but it didn't change the duration to be the same duration as the new appointment type.

Is that a bug?",05/18/2020 1:12 PM;midavis;[~dpark] - Do you have any history on this endpoint and have an opinion on if this is a bug or intended functionality? ,05/21/2020 10:09 AM;midavis;[~dpark] Bumping this up,"06/16/2020 3:04 AM;dpark;[~midavis] sorry I missed this, I will take a look into this today.","06/17/2020 11:48 AM;dpark;The endpoint just does a straight database update with no validation checks to see if the duration will fit or anything like that. I don't believe it's supposed to be used like this, I will update the documentation",06/19/2020 3:10 AM;dpark;Can you verify the changed text [~howatkins] in the changelists,"06/19/2020 6:59 AM;howatkins;Good Morning, [~dpark]! Thank you so much for working so quickly on this one. This may be a bit of a newbie question.. but could you tell me where I can find the changelists to review what you changed? I'm more than happy to review the change before you push it through. However, I'm not a Dev, and I've never been asked to review a change, so I don't know where to find it (or even if I have access to review it). Thank you again!!","06/19/2020 10:20 AM;dpark; !screenshot-1.png|thumbnail! 

I've included the text here instead","06/19/2020 10:28 AM;redger;i'm not sure i understand what this documentation change is meant to convey:

""This endpoint does not do validation checks against the passed in fields therefore it does not modify any fields outside of those that are passed in.""

 ",06/19/2020 11:38 AM;dpark;[~redger] I'm trying to convey that this endpoint is pretty much a straight pass into modifying the three fields providerid/departmentid/appointmenttypeid in the database and does not do any logic or validation around any of those fields.,06/19/2020 11:57 AM;howatkins;Hey [~dpark] – Thank you for providing that screenshot. I think the wording you have in there is fine and explains that it will not update any fields outside of those determined in the input parameters. I appreciate you taking the time to clarify that for our Dev Portal users - Thanks again!,06/22/2020 10:01 AM;redger;approving based on feedback from holly,06/24/2020 7:44 AM;howatkins;Thanks everyone!! I received the changedocumentation.zip and just updated the documentation on our Developer Portal. Have a wonderful rest of the week :),,,,,,,,,,,,,,,,,,,,
"[NEWBIE] Clarify requirements on input parameters that end in ""Date"" to not include a timestamp",SCORE-885,1123480,Story,Code Review,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,None,,,bbartle,bbartle,1/14/20 12:03,6/24/20 15:59,6/24/20 17:27,,,,0,,,,,,,,,,,,,,,"We don't make it clear the input parameters and bodies in our endpoints (e.g. slot search, appointment search) that the ""endDate"" and ""startDate"" parameters should just be dates like 'yyyy-mm-dd', so the apps are passing in fulltime ranges and getting unexpected results. We should document (i.e. update the insomnia and swagger examples) this so this doesn't happen again.",,jpickens,,,,,,,,,,,,,,,,,,,SFTI-8,,,,,,SCORE-946,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,jpickens,6/23/20 0:00,,,,,,,,,,,,,,,,,,fmicle,"
  <div class=""aui-flag"" aria-hidden=""false"">
  	<div class=""aui-message aui-message-info"" style=""width: 400px"">
    	<div>Issue <strong>SCORE-885</strong> doesn't have Definition of Done values.</div>
    </div>
  </div>
   
  ",,,,SCORE-257,,,,,,,,,,,,,,,,,,,,1123480,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-885</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,jpickens,6/23/20 0:00,,,2|i0ki5b:r,,GA,,,,,,,,,,,None,None,,,,,,,,,,,,,,,,,,Danish Denmark,Ecuador Eclair,,2,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,"* The changes in this ticket apply to the following endpoints:
** /api/v1/internal/Appointment/search
** /api/v1/external/Schedule
** /api/v1/external/Schedule/search
** /api/v1/internal/Schedule
** /api/v1/internal/Schedule/search
** /api/v1/external/Slot/availability
** /api/v1/internal/Slot/search
** /api/v1/internal/Slot/availability
* Check out this branch and deploy locally or to Azure.
* Navigate to Swagger, and make sure the endpoints listed above have the correct documentation which informs that the timestamp portion of the date will be ignored.
* Make sure the endpoints using our own view models (as opposed to FHIR objects) show the dates without the time stamp in the examples.
* Start Insomnia and check the same endpoints, making sure the default values don't include timestamps.
* Call each of the endpoints in the list above and make sure the requests work as expected.",,,,,,,,,,,,,,0,,,,,"06/23/2020 4:59 PM;jpickens;I've done Jira sign-offs on this.  But it looks like Robert has added some PR feedback, so I'll let him do the PR Approval.  I may also need to re-QA after any re-codes are done.","06/24/2020 9:36 AM;redger;the question about placement of that class is a philosophical one - feel free to defend your stance.  the comment about fat arrow, null checking, and unit tests should be addressed.",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
[Functionality Clarification] Web Scheduling - Allow appointments within next 1 days,SCORE-818,1032414,Bug,Done,SCORE,Scheduling: Core Architecture (AUS),software,midavis,Develop business logic and APIs to translate scheduling data for consumption by front end components.,,Medium,Done,kmorsey,kmorsey,kmorsey,9/24/19 7:04,6/17/20 15:45,6/24/20 17:27,6/16/20 10:40,,,0,PK_KINA,SECH-Review,,,,,,,,,,,,,"[Client Facing]
*Context:* [11128]
*Brand*: [1] Mount Carmel
*Department:*  [39] MGPC_Grove City Stringtown, [47] MGPC_Pickerington
*Provider*: [894] MGPC_MAWHIRTER_DIANN, [369] MGPC_Sbita_Sara
*Patient:*  1067193a11128, 314835a11128

*Bug Description:*
Need clarification on whether or not 1-day availability to schedule is a rolling 24-hour period for web scheduling.

*Replication Steps:*
 
• Gear
• Communicator
• Patient Appointment Reasons Settings - Sick Visit - Existing Patients

• Gear
• Communicator
• Appointment Settings
• Department - MGPC_Grove City Stringtown > click box with + sign
• Locate provider, MGPC_MAWHIRTER_DIANN > select Custom link in Web Scheduling column
• Edit Settings
• Web scheduling row > Edit Settings
• Sick Visit is mapped to Walk-In 20 (20 Min)
• Walk-In 20 (20 Min) > Allow web scheduling is enabled > Allow appointments within next 1 days

• Gear
• Communicator
• Appointment Settings
• Department - MGPC_Pickerington  > click box with + sign
• Locate provider, MGPC_Sbita_Sara > select Custom link in Web Scheduling column
• Edit Settings
• Web scheduling row > Edit Settings
• Sick Visit is mapped to Walk-In 15 (15 Min)
• Walk-In 15 (15 Min) > Allow web scheduling is enabled > Allow appointments within next 1 days

What is the expected functionality ""Allow appointments within next 1 days""? Is a 1 day availability to schedule a rolling 24 hour period?
",,dpark,keknight,kmorsey,midavis,msatyanarayana,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,<Add Acceptance Criteria Here>,,,,,,,,,,,,,DISABLED,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,SECH-275,,,,,,,P4 Production,,,,,,,,,,,,,1032414,,,,,,,,,,,,,,,,,,,,,,,,,,Patient Experience,,"
  <div class=""aui-flag"" aria-hidden=""false"">
    <div class=""aui-message aui-message-info"" style=""width: 400px"">
      <div>Issue <strong>SCORE-818</strong> doesn't have Product Marketing values.</div>
    </div>
  </div>
   
  ",,,Development,ACTIVE,,,,,,2|hxitx3:,,GA,,,,,,,,,,,None,None,<Text here>,,,9852079,,,,,,,,,4,,,,,Danish Denmark,,,,"Metric:
Target:
Current:",YES,,,,,,,WAT,,,,,,,,,,,,,,,,,,0,,,,,"09/24/2019 7:04 AM;kmorsey;Task created via '[bug triage|https://devnet.athenahealth.com/bug_triage]'

Originally sent to 'SE Consumer Health' because of feature 'Patient Portal: Web Scheduling'.

","12/19/2019 8:24 AM;msatyanarayana;Hi [~kmorsey]

Can you please move this task to scheduling zone board.","03/05/2020 11:44 AM;midavis;[~keknight] - please confirm, but my understanding that 1 day is a business day in the time zone of the client.  NOT a rolling 24 hours.

 

 ",03/16/2020 2:44 PM;keknight;[~midavis] my understanding was a rolling 24 hours.  ,"04/02/2020 10:17 AM;midavis;[~kmorsey] - does the above answer your question?  I would like to close out this ticket.  If I don't hear anything in the next week i'll assume you're all set.

 

Mike","04/02/2020 1:40 PM;kmorsey;Hi [~midavis], you don't seem to agree with each other. Is there a way to check the code to see what it really means by 'Allow appointments within the next 1 day?'. When I look at code browser, I found this (in bold): 

 
  $form->[Append|https://intranet.athenahealth.com/wiki/node.esp?ID=30060&Q=/perllib/Athena/HTML/AthenaForm.pm&func=Append#Append]([Unindent|https://intranet.athenahealth.com/wiki/node.esp?ID=30060&Q=/perllib/Athena/AthenaUtils.pm&func=Unindent#Unindent](qq{
                 $mainradiohtml
                 <div id='patientlabeleditsection'>
                         <div class='editsubfield'>Patient appointment reasons: $infopawns->\{APPOINTMENTREASON}</div>
                         <div class='editindent' id='patientlabels'>$savedpatientlabelhtml</div>
                         <div class='editindent'><a href='#' onclick='AddPatientLabelDropDown({});'>Add another</a></div>
                 </div>
                 <div class=""auxiliaryfields"">
                         <div class='editsubfield'>[[REQUIRECANCELREASONSTATUS]]<label class=noendline for=REQUIRECANCELREASONSTATUSID>Require cancellation reason</label></div>
                         *<div class='editsubfield'>Allow appointments to be scheduled <br />up to [[SCHEDULINGMAXDAYS]] day(s) from today  $infopawns->\{MAXDAYS}</div>*
                         <div class='editsubfield'>Disable Portal actions [[SCHEDULINGMINHOURS]] hours <br />before appointments  $infopawns->\{MINHOURS}</div>
                 </div>
         }));
 
Found this here [https://intranet.athenahealth.com/wiki/node.esp?ID=30060&Q=/perllib/Athena/Appointment/CommunicatorAdminPage.pm&find=EditSchedulablePatientStatus&findany=1#__find]
 
 
 ","04/20/2020 11:52 AM;midavis;[~dpark] - Can you confirm, when we have a rule that doesn't allow appointments within 1 day, if thats a rolling 24 hours or a fixed business day?

Thanks",05/18/2020 1:17 PM;midavis;[~dpark] Bumping this up again ^^^,"06/02/2020 12:58 PM;kmorsey;Hi [~dpark], have you had the chance to determine if this is a rolling 24 hour period or a fixed business day? Client keeps asking. Thanks",06/16/2020 3:05 AM;dpark;[~midavis] soryr I missed this one as well. I will be looking into this and 956 today.,"06/16/2020 9:58 AM;dpark;[~kmorsey] the allow within 1 day, means users can only schedule appointments either the current or next day. It does not mean 24 hours. 

eg: Today is 6/16/20 1:00 AM, they can either schedule for 6/16/20 or until 6/17/20 midnight practice time.","06/16/2020 10:02 AM;kmorsey;Thanks, [~dpark] ! ","06/16/2020 10:07 AM;kmorsey;[~dpark], I'm asking because I know the client will ask...

If it's Friday, and they don't have appointment availability on Saturday and Sunday, would I expect to see appointments on Friday as well as on Monday, assuming open availability? ",06/16/2020 10:44 AM;dpark;No it only checks 1 calendar day in advance regardless of weekend,06/16/2020 11:12 AM;midavis;Can we close this bug now [~kmorsey]?,"06/16/2020 11:17 AM;kmorsey;[~midavis], sure can! Thanks",,,,,,,,,,,,,,,,,